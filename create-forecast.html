<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Real-time analysis and forecasting for outbreak analytics with R: Create a short-term forecast</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XZ471458FQ');
    </script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Epiverse-TRACE" src="assets/images/epiverse-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #FFF">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/create-forecast.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Epiverse-TRACE" src="assets/images/epiverse-logo.svg"></div>
    <div class="lesson-title-md">
      Real-time analysis and forecasting for outbreak analytics with R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Real-time analysis and forecasting for outbreak analytics with R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Real-time analysis and forecasting for outbreak analytics with R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 0%" class="percentage">
    0%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 0%" aria-valuenow="0" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/create-forecast.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        1. Create a short-term forecast
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#create-a-short-term-forecast">Create a short-term forecast</a></li>
<li><a href="#forecasting-secondary-observations">Forecasting secondary observations</a></li>
<li><a href="#challenge-ebola-outbreak-analysis">Challenge: Ebola outbreak analysis</a></li>
<li><a href="#summary">Summary</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="severity-static.html">2. Estimation of outbreak severity</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="superspreading-estimate.html">3. Account for superspreading</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="superspreading-simulate.html">4. Simulate transmission chains</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="index.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="severity-static.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="index.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Home
        </a>
        <a class="chapter-link float-end" href="severity-static.html" rel="next">
          Next: Estimation of... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Create a short-term forecast</h1>
        <p>Last updated on 2024-05-21 |
        
        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/create-forecast.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I create short-term forecasts from case data?</li>
<li>How do I account for incomplete reporting in forecasts?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn how to make forecasts of cases using R package
<code>EpiNow2</code>
</li>
<li>Learn how to include an observation process in estimation</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h3>
<div class="callout-content">
<ul><li>Complete tutorial <a href="quantify-transmissibility.html">Quantifying transmission</a>
</li>
</ul><p>Learners should familiarise themselves with following concept
dependencies before working through this tutorial:</p>
<p><strong>Statistics</strong> : probability distributions, principle of
Bayesian analysis.</p>
<p><strong>Epidemic theory</strong> : Effective reproduction number.</p>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width"><p>Given case data of an epidemic, we can create estimates of the
current and future number of cases by accounting for both delays in
reporting and under reporting. To make statements about the future of th
epidemic, we need to make an assumption of how observations up to the
present are related to what we expect to happen in the future. The
simplest way of doing so is to assume “no change”, i.e., the
reproduction number remains the same in the future as last observed. In
this tutorial we will create short-term <a href="reference.html#forecast">forecasts</a> by assuming the
reproduction number will remain the same as its estimate was on the
final date for which data was available.</p>
<p>In this tutorial we are going to learn how to use the
<a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> package to forecast cases accounting for
incomplete observations and forecast secondary observations like
deaths.</p>
<p>We’ll use the pipe <code>%&gt;%</code> operator to connect functions,
so let’s also call to the <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a> package:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">EpiNow2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="create-a-short-term-forecast"><h2 class="section-heading">Create a short-term forecast<a class="anchor" aria-label="anchor" href="#create-a-short-term-forecast"></a>
</h2>
<hr class="half-width"><p>The function <code>epinow()</code> described in the <a href="quantify-transmissibility.html">quantifying transmission</a>
episode is a wrapper for the functions:</p>
<ul><li>
<code>estimate_infections()</code> used to estimate cases by date of
infection.</li>
<li>
<code>forecast_infections()</code> used to simulate infections using
an existing fit (estimate) to observed cases.</li>
</ul><p>Let’s use the same code used in <a href="quantify-transmissibility.html">quantifying transmission</a>
episode to get the input data, delays and priors:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read cases dataset</span></span>
<span><span class="va">cases</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, <span class="va">cases_new</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>confirm <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">cases_new</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Incubation period</span></span>
<span><span class="va">incubation_period_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">dist_spec</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">4</span>, sd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span>, distribution <span class="op">=</span> <span class="st">"gamma"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log-tranformed mean</span></span>
<span><span class="va">log_mean</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logmean</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Log-transformed std</span></span>
<span><span class="va">log_sd</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logsd</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reporting dalay</span></span>
<span><span class="va">reporting_delay_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">dist_spec</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="va">log_mean</span>, sd <span class="op">=</span> <span class="va">log_sd</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">10</span>, distribution <span class="op">=</span> <span class="st">"lognormal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generation time</span></span>
<span><span class="va">generation_time_fixed</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">dist_spec</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">3.6</span>, sd <span class="op">=</span> <span class="fl">3.1</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span>, distribution <span class="op">=</span> <span class="st">"lognormal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rt mean prior</span></span>
<span><span class="va">rt_log_mean</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logmean</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rt std prior</span></span>
<span><span class="va">rt_log_sd</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">convert_to_logsd</span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<p>Now we can extract the short-term forecast using:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assume we only have the first 90 days of this data</span></span>
<span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">90</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Estimate and forecast</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  reported_cases <span class="op">=</span> <span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_fixed</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_fixed</span> <span class="op">+</span> <span class="va">reporting_delay_fixed</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu">rt_opts</span><span class="op">(</span>prior <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">rt_log_mean</span>, sd <span class="op">=</span> <span class="va">rt_log_sd</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-05-21 01:41:19] epinow: There were 5 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. - 
WARN [2024-05-21 01:41:19] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div id="do-not-wait-for-this-to-complete" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="do-not-wait-for-this-to-complete" class="callout-inner">
<h3 class="callout-title">Do not wait for this to complete!<a class="anchor" aria-label="anchor" href="#do-not-wait-for-this-to-complete"></a>
</h3>
<div class="callout-content">
<p>This last chunk may take 10 minutes to run. Keep reading this
tutorial episode while this runs in the background. For more information
on computing time, read the “Bayesian inference using Stan” section
within the <a href="quantify-transmissibility.html">quantifying
transmission</a> episode.</p>
</div>
</div>
</div>
<p>We can visualise the estimates of the effective reproduction number
and the estimated number of cases using <code>plot()</code>. The
estimates are split into three categories:</p>
<ul><li><p><strong>Estimate</strong> (green): utilises all data,</p></li>
<li><p><strong>Estimate based on partial data</strong> (orange):
contains a higher degree of uncertainty because such estimates are based
on less data,</p></li>
<li><p><strong>Forecast</strong> (purple): forecasts into the
future.</p></li>
</ul><div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><div class="section level3">
<h3 id="forecasting-with-incomplete-observations">Forecasting with incomplete observations<a class="anchor" aria-label="anchor" href="#forecasting-with-incomplete-observations"></a></h3>
<p>In the <a href="quantify-transmissibility.html">quantifying
transmission</a> episode we accounted for delays in reporting.In
<code>EpiNow2</code> we also can account for incomplete observations as
in reality, 100% of cases are not reported. We will pass another
argument into <code>epinow()</code> function called <code>obs</code> to
define an observation model. The format of <code>obs</code> is defined
by the <code>obs_opt()</code> function (see
<code>?EpiNow2::obs_opts</code> for more detail).</p>
<p>Let’s say we believe the COVID-19 outbreak data in the
<code>cases</code> object do not include all reported cases. We believe
that we only observe 40% of cases. To specify this in the observation
model, we must pass a scaling factor with a mean and standard deviation.
If we assume that 40% of cases are in the case data (with standard
deviation 1%), then we specify the <code>scale</code> input to
<code>obs_opts()</code> as follows:</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_scale</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre>
</div>
<p>To run the inference framework with this observation process, we add
<code>obs = obs_opts(scale = obs_scale)</code> to the input arguments of
<code>epinow()</code>:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define observation model</span></span>
<span><span class="va">obs_scale</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assume we only have the first 90 days of this data</span></span>
<span><span class="va">reported_cases</span> <span class="op">&lt;-</span> <span class="va">cases</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">90</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Estimate and forecast</span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  reported_cases <span class="op">=</span> <span class="va">reported_cases</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">generation_time_fixed</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">delay_opts</span><span class="op">(</span><span class="va">incubation_period_fixed</span> <span class="op">+</span> <span class="va">reporting_delay_fixed</span><span class="op">)</span>,</span>
<span>  rt <span class="op">=</span> <span class="fu">rt_opts</span><span class="op">(</span>prior <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="va">rt_log_mean</span>, sd <span class="op">=</span> <span class="va">rt_log_sd</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># Add observation model</span></span>
<span>  obs <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">obs_opts</span><span class="op">(</span>scale <span class="op">=</span> <span class="va">obs_scale</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-05-21 01:48:49] epinow: There were 3 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. - 
WARN [2024-05-21 01:48:49] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">base</span><span class="fu">::</span><span class="fu">summary</span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                                 measure                 estimate
                                  &lt;char&gt;                   &lt;char&gt;
1: New confirmed cases by infection date   18071 (10111 -- 30663)
2:        Expected change in daily cases        Likely decreasing
3:            Effective reproduction no.       0.89 (0.57 -- 1.3)
4:                        Rate of growth -0.015 (-0.063 -- 0.036)
5:          Doubling/halving time (days)          -48 (19 -- -11)</code></pre>
</div>
<p>The estimates of transmission measures such as the effective
reproduction number and rate of growth are similar (or the same in
value) compared to when we didn’t account for incomplete observations
(see <a href="quantify-transmissibility.html">quantifying transmission
episode</a> in the “Finding estimates” section). However the number of
new confirmed cases by infection date has changed substantially in
magnitude to reflect the assumption that only 40% of cases are in the
data set.</p>
<p>We can also change the default distribution from Negative Binomial to
Poisson, remove the default week effect and more. See
<code>?EpiNow2::obs_opts</code> for more details.</p>
<div id="what-are-the-implications-of-this-change" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="what-are-the-implications-of-this-change" class="callout-inner">
<h3 class="callout-title">What are the implications of this change?<a class="anchor" aria-label="anchor" href="#what-are-the-implications-of-this-change"></a>
</h3>
<div class="callout-content">
<ul><li>Compare different percents of observations %</li>
<li>How are they different in the number of infections estimated?</li>
<li>What are the public health implications of this change?</li>
</ul></div>
</div>
</div>
</div>
</section><section id="forecasting-secondary-observations"><h2 class="section-heading">Forecasting secondary observations<a class="anchor" aria-label="anchor" href="#forecasting-secondary-observations"></a>
</h2>
<hr class="half-width"><p><code>EpiNow2</code> also has the ability to estimate and forecast
secondary observations, e.g., deaths and hospitalisations, from a
primary observation, e.g., cases. Here we will illustrate how to
forecast the number of deaths arising from observed cases of COVID-19 in
the early stages of the UK outbreak.</p>
<p>First, we must format our data to have the following columns:</p>
<ul><li>
<code>date</code>: the date (as a date object see
<code>?is.Date()</code>),</li>
<li>
<code>primary</code>: number of primary observations on that date,
in this example <strong>cases</strong>,</li>
<li>
<code>secondary</code>: number of secondary observations date, in
this example <strong>deaths</strong>.</li>
</ul><div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reported_cases_deaths</span> <span class="op">&lt;-</span> <span class="fu">incidence2</span><span class="fu">::</span><span class="va">covidregionaldataUK</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">date</span>, <span class="va">cases_new</span>, <span class="va">deaths_new</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    primary <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">cases_new</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    secondary <span class="op">=</span> <span class="fu">sum</span><span class="op">(</span><span class="va">deaths_new</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<figure style="text-align: center"><img src="fig/create-forecast-rendered-unnamed-chunk-8-1.png" alt="Distribution of secondary cases (deaths). We will drop the first 30 days with no observed deaths. We will use the deaths between day 31 and day 60 to estimate the secondary observations. We will forecast deaths from day 61 to day 90." class="figure mx-auto d-block"><figcaption>
Distribution of secondary cases (deaths). We will drop the first 30 days
with no observed deaths. We will use the deaths between day 31 and day
60 to estimate the secondary observations. We will forecast deaths from
day 61 to day 90.
</figcaption></figure><p>Using the data on cases and deaths between day 31 and day 60, we will
estimate the relationship between the primary and secondary observations
using <code>estimate_secondary()</code>, then forecast future deaths
using <code>forecast_secondary()</code>. For more details on the model
see the <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_secondary.html" class="external-link">model
documentation</a>.</p>
<p>We must specify the type of observation using <code>type</code> in
<code>secondary_opts()</code>, options include:</p>
<ul><li>“incidence”: secondary observations arise from previous primary
observations, i.e., deaths arising from recorded cases.</li>
<li>“prevalence”: secondary observations arise from a combination
current primary observations and past secondary observations, i.e.,
hospital bed usage arising from current hospital admissions and past
hospital bed usage.</li>
</ul><p>In this example we specify
<code>secondary_opts(type = "incidence")</code>. See
<code>?EpiNow2::secondary_opts</code> for more detail.</p>
<p>The final key input is the delay distribution between the primary and
secondary observations. Here this is the delay between case report and
death, we assume this follows a gamma distribution with mean of 14 days
and standard deviation of 5 days (Alternatively, we can use
<code>{epiparameter}</code> to <a href="https://epiverse-trace.github.io/tutorials-early/delays-reuse.html" class="external-link">access
epidemiological delays</a>). Using <code>dist_spec()</code> we specify a
fixed gamma distribution.</p>
<p>There are further function inputs to
<code>estimate_secondary()</code> which can be specified, including
adding an observation process, see
<code>?EpiNow2::estimate_secondary</code> for detail on these
options.</p>
<p>To find the model fit between cases and deaths:</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Estimate from day 31 to day 60 of this data</span></span>
<span><span class="va">cases_to_estimate</span> <span class="op">&lt;-</span> <span class="va">reported_cases_deaths</span><span class="op">[</span><span class="fl">31</span><span class="op">:</span><span class="fl">60</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Estimate secondary cases</span></span>
<span><span class="va">estimate_cases_to_deaths</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">estimate_secondary</span><span class="op">(</span></span>
<span>  reports <span class="op">=</span> <span class="va">cases_to_estimate</span>,</span>
<span>  secondary <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">secondary_opts</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"incidence"</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">dist_spec</span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fl">14</span>, sd <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    max <span class="op">=</span> <span class="fl">30</span>, distribution <span class="op">=</span> <span class="st">"gamma"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="be-cautious-of-time-scale" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="be-cautious-of-time-scale" class="callout-inner">
<h3 class="callout-title">Be cautious of time-scale<a class="anchor" aria-label="anchor" href="#be-cautious-of-time-scale"></a>
</h3>
<div class="callout-content">
<p>In the early stages of an outbreak there can be substantial changes
in testing and reporting. If there are testing changes from one month to
another, then there will be a bias in the model fit. Therefore, you
should be cautious of the time-scale of data used in the model fit and
forecast.</p>
</div>
</div>
</div>
<p>We plot the model fit (shaded ribbons) with the secondary
observations (bar plot) and primary observations (dotted line) as
follows:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">estimate_cases_to_deaths</span>, primary <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-10-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>To use this model fit to forecast deaths, we pass a data frame
consisting of the primary observation (cases) for dates not used in the
model fit.</p>
<p><em>Note : in this episode we are using data where we know the deaths
and cases, so we create a data frame by extracting the cases. But in
practice, this would be a different data set consisting of cases
only.</em></p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast from day 61 to day 90</span></span>
<span><span class="va">cases_to_forecast</span> <span class="op">&lt;-</span> <span class="va">reported_cases_deaths</span><span class="op">[</span><span class="fl">61</span><span class="op">:</span><span class="fl">90</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"primary"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu">colnames</span><span class="op">(</span><span class="va">cases_to_forecast</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"value"</span><span class="op">)</span></span></code></pre>
</div>
<p>To forecast, we use the model fit
<code>estimate_cases_to_deaths</code>:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Forecast secondary cases</span></span>
<span><span class="va">deaths_forecast</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">forecast_secondary</span><span class="op">(</span></span>
<span>  estimate <span class="op">=</span> <span class="va">estimate_cases_to_deaths</span>,</span>
<span>  primary <span class="op">=</span> <span class="va">cases_to_forecast</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">deaths_forecast</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">WARNING<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="warning" tabindex="0"><code>Warning: Removed 30 rows containing missing values (`position_stack()`).</code></pre>
</div>
<figure><img src="fig/create-forecast-rendered-unnamed-chunk-12-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The plot shows the forecast secondary observations (deaths) over the
dates which we have recorded cases for. It is also possible to forecast
deaths using forecast cases, here you would specify <code>primary</code>
as the <code>estimates</code> output from
<code>estimate_infections()</code>.</p>
<div id="credible-intervals" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="credible-intervals" class="callout-inner">
<h3 class="callout-title">Credible intervals<a class="anchor" aria-label="anchor" href="#credible-intervals"></a>
</h3>
<div class="callout-content">
<p>In all <a href="https://epiforecasts.io/EpiNow2/" class="external-link">EpiNow2</a> output figures, shaded regions reflect
90%, 50%, and 20% credible intervals in order from lightest to
darkest.</p>
</div>
</div>
</div>
</section><section id="challenge-ebola-outbreak-analysis"><h2 class="section-heading">Challenge: Ebola outbreak analysis<a class="anchor" aria-label="anchor" href="#challenge-ebola-outbreak-analysis"></a>
</h2>
<hr class="half-width"><div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<p>Download the file <a href="data/ebola_cases.csv">ebola_cases.csv</a>
and read it into R. The simulated data consists of the date of symptom
onset and number of confirmed cases of the early stages of the Ebola
outbreak in Sierra Leone in 2014.</p>
<p>Using the first 3 months (120 days) of data:</p>
<ol style="list-style-type: decimal"><li>Estimate whether cases are increasing or decreasing on day 120 of
the outbreak</li>
<li>Account for a capacity to observe 80% of cases.</li>
<li>Create a two week forecast of number of cases.</li>
</ol><p>You can use the following parameter values for the delay
distribution(s) and generation time distribution.</p>
<ul><li>Incubation period: Log normal<span class="math inline">\((2.487,0.330)\)</span> (<a href="https://doi.org/10.1016/j.phrp.2011.04.001" class="external-link">Eichner et
al. 2011</a> via <code>{epiparameter}</code>)</li>
<li>Generation time: Gamma<span class="math inline">\((15.3,
10.1)\)</span> (<a href="https://www.nejm.org/doi/full/10.1056/NEJMoa1411100" class="external-link">WHO Ebola
Response Team 2014</a>)</li>
</ul><p>You may include some uncertainty around the mean and standard
deviation of these distributions.</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1">Give me a hint</h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>We use the effective reproduction number and growth rate to estimate
whether cases are increasing or decreasing.</p>
<p>We can use the <code>horizon</code> argument within the
<code>epinow()</code> function to extend the time period of the
forecast. The default value is of seven days.</p>
<p>Ensure the data is in the correct format :</p>
<ul><li>
<code>date</code>: the date (as a date object see
<code>?is.Date()</code>),</li>
<li>
<code>confirm</code>: number of confirmed cases on that date.</li>
</ul></div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">SOLUTION</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>To estimate the effective reproduction number and growth rate, we
will use the function <code>epinow()</code>.</p>
<p>As the data consists of date of symptom onset, we only need to
specify a delay distribution for the incubation period and the
generation time.</p>
<p>We specify the distributions with some uncertainty around the mean
and standard deviation of the log normal distribution for the incubation
period and the Gamma distribution for the generation time.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_incubation_period</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">dist_spec</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">2.487</span>, sd <span class="op">=</span> <span class="fl">0.330</span>,</span>
<span>  mean_sd <span class="op">=</span> <span class="fl">0.5</span>, sd_sd <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">20</span>, distribution <span class="op">=</span> <span class="st">"lognormal"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ebola_generation_time</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">dist_spec</span><span class="op">(</span></span>
<span>  mean <span class="op">=</span> <span class="fl">15.3</span>, sd <span class="op">=</span> <span class="fl">10.1</span>,</span>
<span>  mean_sd <span class="op">=</span> <span class="fl">0.5</span>, sd_sd <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max <span class="op">=</span> <span class="fl">30</span>, distribution <span class="op">=</span> <span class="st">"gamma"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We read the data input using <code>readr::read_csv()</code>. This
function recognize that the column <code>date</code> is a
<code>&lt;date&gt;</code> class vector.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read data</span></span>
<span><span class="co"># e.g.: if path to file is data/raw-data/ebola_cases.csv then:</span></span>
<span><span class="va">ebola_cases</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span></span>
<span>  <span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"raw-data"</span>, <span class="st">"ebola_cases.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We define an observation model to scale the estimated and forecast
number of new infections:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define observation model</span></span>
<span><span class="co"># mean of 80% and standard deviation of 1%</span></span>
<span><span class="va">ebola_obs_scale</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.8</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></code></pre>
</div>
<p>As we want to also create a two week forecast, we specify
<code>horizon = 14</code> to forecast 14 days instead of the default 7
days.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebola_estimates</span> <span class="op">&lt;-</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">epinow</span><span class="op">(</span></span>
<span>  reported_cases <span class="op">=</span> <span class="va">ebola_cases</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">120</span>, <span class="op">]</span>, <span class="co"># first 3 months of data only</span></span>
<span>  generation_time <span class="op">=</span> <span class="fu">generation_time_opts</span><span class="op">(</span><span class="va">ebola_generation_time</span><span class="op">)</span>,</span>
<span>  delays <span class="op">=</span> <span class="fu">EpiNow2</span><span class="fu">::</span><span class="fu">delay_opts</span><span class="op">(</span><span class="va">ebola_incubation_period</span><span class="op">)</span>,</span>
<span>  <span class="co"># Add observation model</span></span>
<span>  obs <span class="op">=</span> <span class="fu">obs_opts</span><span class="op">(</span>scale <span class="op">=</span> <span class="va">ebola_obs_scale</span><span class="op">)</span>,</span>
<span>  <span class="co"># horizon needs to be 14 days to create two week forecast (default is 7 days)</span></span>
<span>  horizon <span class="op">=</span> <span class="fl">14</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>WARN [2024-05-21 01:50:48] epinow: There were 17 divergent transitions after warmup. See
https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup
to find out why this is a problem and how to eliminate them. - 
WARN [2024-05-21 01:50:48] epinow: Examine the pairs() plot to diagnose sampling problems
 - </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">ebola_estimates</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                                 measure                estimate
                                  &lt;char&gt;                  &lt;char&gt;
1: New confirmed cases by infection date         126 (60 -- 320)
2:        Expected change in daily cases              Increasing
3:            Effective reproduction no.          1.7 (1.1 -- 3)
4:                        Rate of growth 0.042 (0.0037 -- 0.092)
5:          Doubling/halving time (days)         16 (7.5 -- 190)</code></pre>
</div>
<p>The effective reproduction number <span class="math inline">\(R_t\)</span> estimate (on the last date of the
data) is 1.7 (1.1 – 3). The exponential growth rate of case numbers is
0.042 (0.0037 – 0.092).</p>
<p>Visualize the estimates:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot</span><span class="op">(</span><span class="va">ebola_estimates</span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="forecasting-with-estimates-of-r_t" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="forecasting-with-estimates-of-r_t" class="callout-inner">
<h3 class="callout-title">Forecasting with estimates of<span class="math inline">\(R_t\)</span><a class="anchor" aria-label="anchor" href="#forecasting-with-estimates-of-r_t"></a>
</h3>
<div class="callout-content">
<p>By default, the short-term forecasts are created using the latest
estimate of the reproduction number <span class="math inline">\(R_t\)</span>. As this estimate is based on partial
data, it has considerable uncertainty.</p>
<p>The reproduction number that is projected into the future can be
changed to a less recent estimate based on more data using
<code>rt_opts()</code>:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rt_opts</span><span class="op">(</span>future <span class="op">=</span> <span class="st">"estimate"</span><span class="op">)</span></span></code></pre>
</div>
<p>The result will be less uncertain forecasts (as they are based on
<span class="math inline">\(R_t\)</span> with a narrower uncertainty
interval) but the forecasts will be based on less recent estimates of
<span class="math inline">\(R_t\)</span> and assume no change since
then.</p>
<p>Additionally, there is the option to <a href="reference.html#projection">project</a> the value of <span class="math inline">\(R_t\)</span> into the future using a generic model
by setting <code>future = "project"</code>. As this option uses a model
to forecast the value of <span class="math inline">\(R_t\)</span>, the
result will be forecasts that are more uncertain than
<code>estimate</code>, for an example <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_infections_options.html#projecting-the-reproduction-number-with-the-gaussian-process" class="external-link">see
here</a>.</p>
</div>
</div>
</div>
</section><section id="summary"><h2 class="section-heading">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width"><p><code>EpiNow2</code> can be used to create short term forecasts and
to estimate the relationship between different outcomes. There are a
range of model options that can be implemented for different analysis,
including adding an observational process to account for incomplete
reporting. See the <a href="https://epiforecasts.io/EpiNow2/dev/articles/estimate_infections_options.html" class="external-link">vignette</a>
for more details on different model options in <code>EpiNow2</code> that
aren’t covered in these tutorials.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>We can create short-term forecasts by making assumptions about the
future behaviour of the reproduction number</li>
<li>Incomplete case reporting can be accounted for in estimates</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="index.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="severity-static.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="index.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Home
        </a>
        <a class="chapter-link float-end" href="severity-static.html" rel="next">
          Next: Estimation of... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/create-forecast.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/epiverse-trace/tutorials-middle/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/epiverse-trace/tutorials-middle/" class="external-link">Source</a></p>
				<p><a href="https://github.com/epiverse-trace/tutorials-middle/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:andree.valle-campos@lshtm.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/epiverse-trace/sandpaper/tree/patch-renv-github-bug" class="external-link">sandpaper (0.16.4)</a>, <a href="https://github.com/carpentries/pegboard/tree/a32a7836d4455f407c3cafe8ab95edc636e5e919" class="external-link">pegboard (0.7.5)</a>, and <a href="https://github.com/epiverse-trace/varnish/tree/epiversetheme" class="external-link">varnish (1.0.2)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://epiverse-trace.github.io/tutorials-middle/create-forecast.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "forecasts, epidemic models, interventions",
  "name": "Create a short-term forecast",
  "creativeWorkStatus": "active",
  "url": "https://epiverse-trace.github.io/tutorials-middle/create-forecast.html",
  "identifier": "https://epiverse-trace.github.io/tutorials-middle/create-forecast.html",
  "dateCreated": "2024-05-04",
  "dateModified": "2024-05-21",
  "datePublished": "2024-06-11"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

