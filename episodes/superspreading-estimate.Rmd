---
title: 'Account for superspreading'
teaching: 10
exercises: 2
---

```{r setup, echo= FALSE, message = FALSE, warning = FALSE}
library(webshot)
webshot::install_phantomjs(force = TRUE)
```


:::::::::::::::::::::::::::::::::::::: questions 

- How to evaluate for transmission heterogeneity from contact tracing data?
- How to account for transmission heterogeneity in decision-making?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Create the offspring distribution from outbreak data using `{epicontacts}`.
- Estimate the dispersion parameter from the offspring distribution using `{fitdistrplus}`.
- Estimate the proportion of transmission accounting for superspreading events using `{superspreading}`.

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: prereq

## Prerequisites

Learners should familiarise themselves with following concept dependencies before working through this tutorial: 

**Statistics**: probability distributions. 

**Epidemic theory**: Reproduction number.

:::::::::::::::::::::::::::::::::

## Introduction

<!-- we know -->

From epidemics like Smallpox or the severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2), we know that some people spread disease more than others. Since disease transmission is caused by many physiological and social factors, we usually use population averages to assess the disease potential to spread. However, individual differences in infectiousness increase the tendency towards superspreading events (SSEs) which can ignite explosive epidemics and affect the ease of control.

![**Chains of SARS-CoV-2 transmission in Hong Kong initiated by local or imported cases.** (**a**), Transmission network of a cluster of cases traced back to a collection of four bars across Hong Kong (n = 106). (**b**), Transmission network associated with a wedding without clear infector–infectee pairs but linked back to a preceding social gathering and local source (n = 22). (**c**), Transmission network associated with a temple cluster of undetermined source (n = 19). (**d**), All other clusters of SARS-CoV-2 infections where the source and transmission chain could be determined ([Adam et al., 2020](https://www.nature.com/articles/s41591-020-1092-0)).](fig/see-intro-superspreading.png)

<!-- we dont know -->

The [basic reproduction number](../learners/reference.md#basic), $R_0$, is the average number of cases caused by one infectious individual in a entirely susceptible population. Population estimates of $R_0$ can obscure considerable individual variation in infectiousness, as highlighted during the global emergence of SARS-CoV-2 by numerous ‘superspreading events’ in which certain individuals infected unusually large numbers of secondary cases ([Lloyd-Smith et al., 2005](https://www.nature.com/articles/nature04153)).

![**Observed offspring distribution of SARS-CoV-2 transmission in Hong Kong.** N = 91 SARS-CoV-2 infectors, N = 153 terminal infectees and N = 46 sporadic local cases. Histogram bars indicate the proportion of onward transmission per amount of secondary cases. Line corresponds to a fitted negative binomial distribution ([Adam et al., 2020](https://www.nature.com/articles/s41591-020-1092-0)).](fig/see-intro-secondary-cases-fig-b.png){alt='R = 0.58 and k = 0.43.'}

<!-- we want -->

In this tutorial, we are going to estimate the individual variation in transmission and assess its heterogeneity, which often results in superspreading events. Also, we are going to use these estimates to account for superspreading in contact tracing interventions.

We are going to use data from the `{outbreaks}` package, manage linelist and contacts data using `{epicontacts}`, and estimate distribution parameters with `{fitdistrplus}`. Lastly, we are going to use `{superspreading}` to account for it in decision-making.

We’ll use the pipe `%>%` to connect some of their functions, so let’s also call to the `{tidyverse}` package:

```{r,message=FALSE,warning=FALSE}
library(outbreaks)
library(epicontacts)
library(fitdistrplus)
library(superspreading)
library(tidyverse)
```

## The individual reprodution number

The individual reproduction number is defined as the number of secondary cases caused by a particular infected individual. 

Early in an outbreak we can use contact data to reconstruct transmission trees (whom infected whom) and calculate the number of secondary cases generated by each individual. Reconstruction of trees from contact data can provide an understanding of who contributes more to transmission and evaluate for heterogeneous distribution ([Cori et al., 2017](https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371)).

Let's practice this using the `mers_korea_2015` linelist and contact data from the `{outbreaks}` package and integrate them with the `{epicontacts}` package to calculate the distribution of secondary cases ([Campbell, 2022](https://community.appliedepi.org/t/estimating-the-degree-of-super-spreading-from-transmission-chain-data/103/2)):

```{r}
## first, make an epicontacts object
epi_contacts <-
  epicontacts::make_epicontacts(
    linelist = mers_korea_2015$linelist,
    contacts = mers_korea_2015$contacts
  )
```

```{r,eval=FALSE}
# visualise contact tree
epicontacts::vis_epicontacts(epi_contacts)
```

```{r,echo=FALSE}
# visualise contact tree
network <-
  vis_epicontacts(epi_contacts) %>%
  visNetwork::visPhysics(solver = "barnesHut")

fname <- "network.html"

visNetwork::visSave(network, fname)

webshot::webshot(
  fname,
  delay = 5,
  zoom = 10
)
```

::::::::::::::::::::::::::: spoiler

### Is contact data tidy?

Contact data contains information of whom infected whom. We expect to have the infector (`from`) and the infectee (`to`) plus additional columns of variables related to their contact like location (`exposure`) and date of contact.

Following [tidy data](https://tidyr.tidyverse.org/articles/tidy-data.html#tidy-data) principles, in contact data the observation unit is the **infector-infectee** pair. Although one infector can infect multiple infectees, from contact tracing investigations we may record infectees contacts with more than one infector. But we should expect to have unique infector-infectee pairs.

We can check on replicates for infectees:

```{r}
# no infector-infectee pairs are replicated
epi_contacts %>%
  pluck("contacts") %>%
  group_by(to) %>%
  filter(n() > 1)
```

:::::::::::::::::::::::::::

When each infector-infectee row is unique, the number of entries per infector corresponds to their number of secondary cases.

```{r}
# count secondary cases per infector
infector_secondary <- epi_contacts %>%
  pluck("contacts") %>%
  count(from, name = "secondary_cases")
```

But this output only contains number of secondary cases for reported infectors, not for each of the individuals in the whole `epicontacts` object.

To get this, first, we can use `epicontacts::get_id()` to get the full list of unique identifiers ("id") from the `epicontacts` class object. Second, join it with the count secondary cases per infector stored in the `infector_secondary` object. Third, replace the missing values with `0` to express no report of secondary cases from them.

```{r,message=FALSE,warning=FALSE}
all_secondary <- epi_contacts %>%
  # extract ids in contact *and* linelist using "which" argument
  epicontacts::get_id(which = "all") %>%
  # transform vector to dataframe to use left_join()
  enframe(name = NULL, value = "from") %>%
  # join count secondary cases per infectee
  left_join(infector_secondary) %>%
  # infectee with missing secondary cases are replaced with zero
  replace_na(
    replace = list(secondary_cases = 0)
  )
```

From a histogram of the `all_secondary` object, we can identify the **heterogeneity** in the number of secondary cases. Three cases were related to more than 20 secondary cases, while the complementary cases with less than five or zero secondary cases.

```{r,echo=FALSE,eval=FALSE}
# arrange in descendant order of secondary cases
all_secondary %>%
  arrange(desc(secondary_cases))
```

<!-- Visualizing the number of secondary cases on a histogram will help us to relate this with the statistical distribution to fit: -->

```{r}
## plot the distribution
all_secondary %>%
  ggplot(aes(secondary_cases)) +
  geom_histogram(binwidth = 1) +
  labs(
    x = "Number of secondary cases",
    y = "Frequency"
  )
```

The number of secondary cases can be used to _empirically_ estimate the **offspring distribution**, which is the number of secondary _infections_ caused by each case. One candidate statistical distribution used to model the offspring distribution is the **negative binomial** distribution with two parameters:

- **Mean**, which represents the $R_{0}$, the average number of (secondary) cases produced by a single individual in an entirely susceptible population, and

- **Dispersion**, expressed as $k$, which represents the degree of heterogeneity in transmission by single individuals.

```{r,echo=FALSE,message=FALSE,warning=FALSE}
# Load parameters
mpox <- epiparameter::epidist_db(
  disease = "SARS",
  epi_dist = "offspring_distribution",
  single_epidist = TRUE
)
mpox_params <- epiparameter::get_parameters(mpox)
# mpox_params

# calculate density fit
fit_density <-
  tibble(quantile = 0:40) %>%
  mutate(
    density = dnbinom(
      x = quantile,
      mu = mpox_params["mean"],
      size = mpox_params["dispersion"]
    )
  )

# plot offspring distribution with density fit
ggplot() +
  geom_line(
    data = fit_density,
    mapping =
      aes(
        x = quantile,
        y = density
      )
  ) +
  geom_vline(
    aes(xintercept = mpox_params["mean"]
    ), lty = 2
  ) +
  annotate(
    "text", label = "mean Ro",
    x = mpox_params["mean"] + 5,
    y = 0.5,
    size = 8,
    colour = "red"
  ) +
  labs(
    x = "Individual reproductive number",
    y = "Density"
  )
```

From the histogram and density plot, we can identify that the offspring distribution is highly skewed or **overdispersed**. In this framework, the superspreading events (SSEs) are realizations from the right-hand tail of the offspring distribution ([Lloyd-Smith et al., 2005](https://www.nature.com/articles/nature04153)).

::::::::::::::::::::::::::: callout

### Terminology recap

- From linelist and contact data, we calculate the **number of secondary cases** caused by the observed infected individuals.
- The **individual reproductive number** is a random variable representing the _expected_ number of secondary cases caused by a infected individual.
- From the stochastic effects in transmission, the number of secondary _infections_ caused by each case is described by an **offspring distribution**.
- An _empirical_ offspring distribution can be modeled by the **negative-binomial** distribution with mean $R_{0}$ and dispersion parameter $k$.

:::::::::::::::::::::::::::

::::::::::::::::::::::::::::: spoiler

### Poisson, overdispersion, and Negative Binomial

<!-- distribution stories -->

For occurrences of associated discrete events we can use **Poisson** or negative binomial discrete distributions.

In a Poisson distribution, mean is equal to variance. But when variance is higher than the mean, this is called **overdispersion**. In biological applications, overdispersion occurs and so a negative binomial may be worth considering as an alternative to Poisson distribution.

**Negative binomial** distribution is specially useful for discrete data over an unbounded positive range whose sample variance exceeds the sample mean. In such terms, the observations are overdispersed with respect to a Poisson distribution, for which the mean is equal to the variance.

In epidemiology, [negative binomial](https://en.wikipedia.org/wiki/Negative_binomial_distribution) have being used to model disease transmission for infectious diseases where the likely number of onward infections may vary considerably from individual to individual and from setting to setting.

:::::::::::::::::::::::::::::

:::::::::::::::::::::::::::::::::: challenge

Calculate the distribution of secondary cases for Ebola using the `ebola_sim_clean` object from `{outbreaks}` package.

Does the offspring distribution is skewed or overdispersed?

:::::::::::::::::: hint

**Note:** This dataset has `r nrow(ebola_sim_clean$linelist)` cases. Running `epicontacts::vis_epicontacts()` may overload your session!

::::::::::::::::::

:::::::::::::::::: solution

```{r}
## first, make an epicontacts object
ebola_contacts <-
  epicontacts::make_epicontacts(
    linelist = ebola_sim_clean$linelist,
    contacts = ebola_sim_clean$contacts
  )

# visualise contact tree
# (this network can overload your session!)
#epicontacts::vis_epicontacts(ebola_contacts)

# count secondary cases

ebola_infector_secondary <- ebola_contacts %>%
  pluck("contacts") %>%
  count(from, name = "secondary_cases")

ebola_secondary <- ebola_contacts %>%
  # extract ids in contact *and* linelist using "which" argument
  epicontacts::get_id(which = "all") %>%
  # transform vector to dataframe to use left_join()
  enframe(name = NULL, value = "from") %>%
  # join count secondary cases per infectee
  left_join(ebola_infector_secondary) %>%
  # infectee with missing secondary cases are replaced with zero
  replace_na(
    replace = list(secondary_cases = 0)
  )

# arrange in descendant order of secondary cases
# ebola_secondary %>% 
#   arrange(desc(secondary_cases))

## plot the distribution
ebola_secondary %>%
  ggplot(aes(secondary_cases)) +
  geom_histogram(binwidth = 1) +
  labs(
    x = "Number of secondary cases",
    y = "Frequency"
  )
```

From a visual inspection, the distribution of secondary cases for the Ebola data set in `ebola_sim_clean` shows an skewed distribution with secondary cases equal or lower than 6. We need to complement this observation with a statistical analysis to evaluate for overdispersion.

::::::::::::::::::

::::::::::::::::::::::::::::::::::

## Estimate the dispersion parameter

To empirically estimate the dispersion parameter $k$, we can to fit a negative binomial distribution to the number of secondary cases.

We can fit distributions to data using the `{fitdistrplus}` package, which provides maximum likelihood estimates.

```{r}
library(fitdistrplus)

## fit distribution
offspring_fit <- all_secondary %>%
  pull(secondary_cases) %>%
  fitdist(distr = "nbinom")

offspring_fit
```

:::::::::::::::::::::::::::::::: callout

### Name of parameters

From the `{fitdistrplus}` output:

- The `size` object refers to the estimated dispersion parameter $k$, and
- The `mu` object refers to the estimated mean, which represents the $R_{0}$, 

::::::::::::::::::::::::::::::::

```{r,echo=FALSE}
## extract the "size" parameter
mid <- offspring_fit$estimate[["size"]]

## calculate the 95% confidence intervals using the standard error estimate and
## the 0.025 and 0.975 quantiles of the normal distribution.
lower <- mid + offspring_fit$sd[["size"]] * qnorm(0.025)
upper <- mid + offspring_fit$sd[["size"]] * qnorm(0.975)
```

From the number secondary cases distribution we estimated a dispersion parameter $k$ of
`r round(mid, 3)`, with a 95% Confidence Interval from `r round(lower, 3)` to `r round(upper, 3)`. As the value of $k$ is significantly lower than one, we can conclude that the degree of superspreading is high.

We can overlap the estimated density values of the fitted negative binomial distribution and the histogram of the number of secondary cases:

```{r,echo=FALSE}
# calculate density fit
fit_density <-
  tibble(quantile = 0:40) %>%
  mutate(
    density = dnbinom(
      x = quantile,
      mu = offspring_fit$estimate[["mu"]],
      size = mid
    )
  ) %>% 
  mutate(label = "Fitted\nnegative\nbinomial\ndistribution")

# plot offspring distribution with density fit
ggplot() +
  geom_histogram(
    data = all_secondary,
    mapping =
      aes(
        x = secondary_cases,
        y = after_stat(density)
      ), fill = "white", color = "black",
    binwidth = 1
  ) +
  geom_point(
    data = fit_density,
    mapping = aes(
      x = quantile,
      y = density,
      color = label
    ),
    alpha = 0.5
  ) +
  geom_line(
    data = fit_density,
    mapping = aes(
      x = quantile,
      y = density
    ),
    alpha = 0.5, color = "red"
  ) +
  labs(
    x = "Number of secondary cases",
    y = "Density",
    color = "Legend"
  ) +
  theme_bw()
```

:::::::::::::::::::: callout

### Transmission heterogeneity

Heterogeneity is defined by the relationship between the mean ($R_{0}$), dispersion ($k$), and the variance of a negative binomial distribution.

The negative binomial model has $variance = R_{0}(1+\frac{R_{0}}{k})$, so smaller values of $k$ indicate greater variance and, consequently, greater **heterogeneity**.

$$\uparrow variance = R_{0}(1+\frac{R_{0}}{\downarrow k})$$

When $k$ approaches infinity ($k \rightarrow \infty$) and the variance equals the mean (because $\frac{R_{0}}{\infty}=0$), the negative binomial model approaches the conventional Poisson model.

::::::::::::::::::::

::::::::::::::::::::::: challenge

Use the distribution of secondary cases from the `ebola_sim_clean` object from `{outbreaks}` package.

Fit a negative binomial distribution to estimate the mean and dispersion parameter of the offspring distribution.

Does the estimated dispersion parameter provide evidence of transmission heterogeneity?

:::::::::::::: hint

Review how to fit a negative binomial distribution using the `fitdistrplus::fitdist()` function.

::::::::::::::

:::::::::::::: solution

```{r}
ebola_offspring <- ebola_secondary %>%
  pull(secondary_cases) %>%
  fitdist(distr = "nbinom")

ebola_offspring
```

```{r}
## extract the "size" parameter
ebola_mid <- ebola_offspring$estimate[["size"]]

## calculate the 95% confidence intervals using the standard error estimate and
## the 0.025 and 0.975 quantiles of the normal distribution.

ebola_lower <- ebola_mid + ebola_offspring$sd[["size"]] * qnorm(0.025)

ebola_upper <- ebola_mid + ebola_offspring$sd[["size"]] * qnorm(0.975)

# ebola_mid
# ebola_lower
# ebola_upper
```

From the number secondary cases distribution we estimated a dispersion parameter $k$ of
`r round(ebola_mid, 3)`, with a 95% Confidence Interval from `r round(ebola_lower, 3)` to `r round(ebola_upper, 3)`.

For dispersion parameter estimates higher than one we get low distribution variance, hence, low heterogeneity.

::::::::::::::

:::::::::::::: solution

### Select the best model

We can use the maximum likelihood estimates from `{fitdistrplus}` to compare different models and assess fit performance using estimators like the AIC and BIC. Read further in the vignette on [Estimate individual-level transmission](https://epiverse-trace.github.io/superspreading/articles/estimate_individual_level_transmission.html) and use the `{superspreading}` helper function `ic_tbl()` for this!

::::::::::::::

:::::::::::::::::::::::

## Evidence for variation in individual reproductive number EDIT!

[Lloyd-Smith et al., 2005](https://www.nature.com/articles/nature04153) use a 20/80 rule to show how the core principle of heterogeneous transmission is supported.

- focus on the cumulative probability distribution of the most infectious cases
    + if there is a 0.2 proportion of (the most infectious) cases contributing to the 0.8 proportion of transmission, this is a highly heterogeneous distribution. (e.g. SARS)
    + if there is a 0.6 proportion of (the most infectious) cases contributing to the 0.8 of transmission, this is a less heterogeneous distribution (compared to the above one, e.g. pneumonic plague)

![Proportion of transmission expected from the most infectious 20% of cases, for 10 outbreak or surveillance data sets (triangles). Dashed lines show proportions expected under the 20/80 rule (top) and homogeneity (bottom). Superscript ‘v’ indicates a partially vaccinated population.](fig/SEE-individual-reproductive-number-fig-c.png)

The comparison of directly transmitted infections reveals the differing degree of individual variation among diseases and outbreak settings. Like SARS, measles in highly vaccinated populations shows high variation, with heterogeneous vaccination coverage as an important environmental factor contributing to this pattern. Monkeypox and smallpox viruses show intermediate variation, consistent across multiple data sets, and pneumonic plague transmission is slightly less variable.

![Expected proportion of all transmission due to a given proportion of infectious cases, where cases are ranked by infectiousness. For a homogeneous population (all ν = R0), this relation is linear. For five directly transmitted infections (based on specific k values), the line is concave owing to variation in ν.](fig/SEE-individual-reproductive-number-fig-b.png)

::::::::::::::::::::::::::::::::::

## Backward and forward contact tracing

Contact tracing can be deployed in multiple strategies. Forward tracing targets downstream individuals who may be infected by index individual. Backward tracing targets the upstream primary case who infected the index case (or a setting or event at which the index case was infected) by retracing history of contact to the likely point of exposure up to the upper bound of the incubation period.

In the presence of heterogeneous transmission, i.e., with an overdispersed offspring distribution, if this primary case is identified, a larger fraction of the transmission chain can be detected by forward tracing each of the contacts of this primary case  ([Endo et al., 2020](https://wellcomeopenresearch.org/articles/5-239/v3)).

![Schematic representation of contact tracing strategies. Black arrows indicate the directions of transmission, blue and Orange arrows, a successful or failed contact tracing, respectivelly. When there is evidence of individual-level transmission heterogeneity, often resulting in superspreading, backward contact tracing from the index case (blue circle) increase the probability to find the primary case (green circle) or clusters with a larger fraction of cases, potentially increasing the number of quarentined cases (yellow circles). [Claire Blackmore, 2021](https://www.paho.org/sites/default/files/backward_contact_tracing_v3_0.pdf)](fig/contact-tracing-strategies.png)

When there is evidence of individual-level variation (i.e. overdispersion), often resulting in so-called superspreading events, a large proportion of infections may be linked to a small proportion of original clusters. As a result, finding and targeting originating clusters in combination with reducing onwards infection may substantially enhance the effectiveness of tracing methods [Endo et al., 2020](https://wellcomeopenresearch.org/articles/5-239/v3). 

Empirical evidence focused on evaluating the efficiency of backward tracing lead to 42% more cases identified than forward tracing supporting its implementation when rigorous suppression of transmission is justified ([Raymenants et al., 2022](https://www.nature.com/articles/s41467-022-32531-6))


## Proportion of events in a given cluster size

By looking at the tail of the probability offspring distribution, we can identify the size of the cluster of secondary infections. The probability that a cluster of secondary infections caused by a primary case identified by backward tracing has a size of $X$ or larger ([Endo et al., 2020](https://wellcomeopenresearch.org/articles/5-239/v3)).

```{r}
# estimate the probability of
# having a cluster size of 5, 10, or 25
# secondary cases from a primary case,
# given known reproduction number and
# dispersion parameter.
proportion_cluster_size(
  R = offspring_fit$estimate["mu"],
  k = offspring_fit$estimate["size"],
  cluster_size = c(5, 10, 25)
)

```

Even though we have an $R<1$, given a highly overdispersed offspring distribution ($k=0.02$) we have a 46.9% probability to find a cluster of 25 people or larger. Then, by following a backwards strategy, contact tracing efforts will increase their probability to find the primary case and successfully contain and quarantine an increased proportion of contacts.

We can also use this number to prevent gathering of certain sized to reduce the epidemic by preventing potential superspreading events. Interventions can target to reduce the reproduction number in order to reduce the probability of having clusters of secondary cases.


::::::::::::::::::::::: challenge

reuse ebola parameters? interpret

:::::::::::::::::::::::

## Challenges

::::::::::::::::::::::::::: challenge

use mers to estimate ... [pending]

:::::::::::::::::::::::::::

:::::::::::::::::::::::::: challenge

inform backward contact tracing strategy for ebola [pending]

:::::::::::::::::::::::::


::::::::::::::::::::::::::::: challenge

What is the proportion of cases that are responsible of the 80% of transmission?

Compare the estimates for **MERS** using the offspring distributions parameters from this tutorial episode, with **SARS** and **Ebola** offspring distributions parameter accessible via the `{epiparameter}` R package.

::::::::::::::::::::: hint

Use `superspreading::proportion_transmission()` and `{epiparameter}`.

```{r,message=FALSE,warning=FALSE,echo=FALSE}
library(epiparameter)

epidist_string <- epidist_db(
  epi_dist = "offspring distribution"
) %>%
  list_distributions() %>%
  dplyr::select(disease) %>%
  distinct() %>%
  pull() %>%
  paste(collapse = ", ")
```

Currently, `{epiparameter}` have offspring distributions for `r epidist_string`. Let's access the offspring distribution `mean` and `dispersion` parameters for SARS:

```{r,message=FALSE,warning=FALSE}
# Load parameters
sars <- epiparameter::epidist_db(
  disease = "SARS",
  epi_dist = "offspring distribution",
  single_epidist = TRUE
)
sars_params <- epiparameter::get_parameters(sars)
sars_params
```

:::::::::::::::::::::

::::::::::::::::::::: solution

```{r}
#' estimate for ebola --------------

ebola_epiparameter <- epiparameter::epidist_db(
  disease = "Ebola",
  epi_dist = "offspring distribution",
  single_epidist = TRUE
)
ebola_params <- epiparameter::get_parameters(ebola_epiparameter)
ebola_params

# estimate
# proportion of cases that
# generate 80% of transmission
proportion_transmission(
  R = ebola_params[["mean"]],
  k = ebola_params[["dispersion"]],
  percent_transmission = 0.8
)

#' estimate for sars --------------

# estimate
# proportion of cases that
# generate 80% of transmission
proportion_transmission(
  R = sars_params[["mean"]],
  k = sars_params[["dispersion"]],
  percent_transmission = 0.8
)


#' estimate for mers --------------

# estimate
# proportion of cases that
# generate 80% of transmission
proportion_transmission(
  R = offspring_fit$estimate["mu"],
  k = offspring_fit$estimate["size"],
  percent_transmission = 0.8
)
```

Among Ebola, SARS, and MERS, MERS has the lowest percent of cases (2.1%) responsible of the 80% of the transmission, representative of highly overdispersed offspring distributions.

Among them, Ebola has the highest percent of cases (43%) responsible of the 80% of the transmission. This is representative of offspring distributions with high dispersion parameters.

:::::::::::::::::::::

:::::::::::::::::::::::::::::

::::::::::::::::::::::::: challenge

### Define Superspreading events

[Lloyd-Smith et al., 2005](https://www.nature.com/articles/nature04153) propose a general protocol for defining a superspreading event (SSE). If the number of secondary infections caused by each case, $Z$, follows a negative binomial distribution ($R_{o}, k$):

- We define an SSE as any infected individual who infects more than Z(n) others, where Z(n) is the nth percentile of the Poisson(R) distribution. 
- A 99th-percentile SSE is then any case causing more infections than would occur in 99% of infectious histories in a homogeneous population

Using the corresponding distribution function in R, estimate the SSE threshold to define a SSE.

::::::::::::::::: hint

You can review the [R probability functions for the normal distribution](https://sakai.unc.edu/access/content/group/3d1eb92e-7848-4f55-90c3-7c72a54e7e43/public/docs/lectures/lecture13.htm#probfunc), and then read the `?dpois` reference manual.

In a Poisson distribution, the lambda or rate parameter are equal to the estimated mean from a negative binomial distribution. You can explore this in [The distribution zoo](https://ben18785.shinyapps.io/distribution-zoo/) shiny app.

:::::::::::::::::

::::::::::::::::: hint

### inverse-dispersion?

The dispersion parameter $k$ can be expressed differently across the literature. 

- In the Wikipedia page for the negative binomial, this parameter is defined in its reciprocal form (refer to the [variance equation](https://en.wikipedia.org/wiki/Negative_binomial_distribution)). 
- In [the distribution zoo](https://ben18785.shinyapps.io/distribution-zoo/) shiny app, the dispersion parameter $k$ is named "Inverse-dispersion" but it is equal to parameter estimated in this episode. We invite you to explore this!

:::::::::::::::::

::::::::::::::::: solution

```{r}
qpois(
  p = 0.99,
  lambda = offspring_fit$estimate["mu"]
)
```

![Reported superspreading events (SSEs; diamonds) relative to estimated reproductive number R (squares) for twelve directly transmitted infections. Lines show 5–95 percentile range of Z∼Poisson(R), and crosses show the 99th-percentile proposed as threshold for SSEs. Stars represent SSEs caused by more than one source case. ‘Other’ diseases are: 1, Streptococcus group A; 2, Lassa fever; 3, Mycoplasma pneumonia; 4, pneumonic plague; 5, tuberculosis. R is not shown for ‘other’ diseases, and is off-scale for monkeypox.](fig/SEE-individual-reproductive-number-fig-d.png)

:::::::::::::::::

::::::::::::::::::::::::


::::::::::::::::::::::::::::: testimonial

### Read these blog posts

The [Tracing monkeypox](https://plus.maths.org/content/monkeypox) article from the [JUNIPER](https://maths.org/juniper/) consortium showcases the usefulness of network models on contact tracing.

The [Going viral](https://kucharski.substack.com/p/going-viral) post from Adam Kucharski shares insides from YouTube virality, disease outbreaks, and marketing campaigns on the conditions that spark contagion online.

:::::::::::::::::::::::::::::


::::::::::::::::::::::::::::::::::::: keypoints 

- Use `{epicontacts}`
- Use `{fitdistplus}`
- Use `{superspreading}` to 

::::::::::::::::::::::::::::::::::::::::::::::::

