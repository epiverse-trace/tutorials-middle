<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Real-time analysis and forecasting for outbreak analytics with R: Simulate transmission chains</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XZ471458FQ');
    </script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/epiverse-trace/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/epiverse-trace/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/epiverse-trace/favicon-16x16.png"><link rel="manifest" href="favicons/epiverse-trace/site.webmanifest"><link rel="mask-icon" href="favicons/epiverse-trace/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav epiverse-trace"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="epiverse-trace-logo" alt="epiverse-trace" src="assets/images/epiverse-trace-logo.svg"><span class="badge text-bg-danger" style="background-color: #FF4955; border-radius: 5px">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/superspreading-simulate.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav epiverse-trace" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="epiverse-trace" src="assets/images/epiverse-trace-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Real-time analysis and forecasting for outbreak analytics with R
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Real-time analysis and forecasting for outbreak analytics with R
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="intro-renewal-equation.html">Introduction to the Renewal equation</a></li><li><a class="dropdown-item" href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Real-time analysis and forecasting for outbreak analytics with R
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 86%" class="percentage">
    86%
  </div>
  <div class="progress epiverse-trace">
    <div class="progress-bar epiverse-trace" role="progressbar" style="width: 86%" aria-valuenow="86" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/superspreading-simulate.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="delays-access.html">1. Access epidemiological delay distributions</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="quantify-transmissibility.html">2. Quantifying transmission</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="delays-functions.html">3. Use delay distributions in analysis</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="create-forecast.html">4. Create a short-term forecast</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="severity-static.html">5. Estimation of outbreak severity</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="superspreading-estimate.html">6. Account for superspreading</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Simulate transmission chains
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#simulation-of-uncontrolled-outbreaks">Simulation of uncontrolled outbreaks</a></li>
<li><a href="#get-the-offspring-distribution">Get the offspring distribution</a></li>
<li><a href="#get-generation-time">Get generation time</a></li>
<li><a href="#simulate-a-single-chain">Simulate a single chain</a></li>
<li><a href="#simulate-multiple-chains">Simulate multiple chains</a></li>
<li><a href="#iterate-simulations">Iterate simulations</a></li>
<li><a href="#visualize-multiple-chains">Visualize multiple chains</a></li>
<li><a href="#challenges">Challenges</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="intro-renewal-equation.html">Introduction to the Renewal equation</a></li><li><a href="reference.html">Glossary of Terms: Epiverse-TRACE</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="superspreading-estimate.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="superspreading-estimate.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Account for
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Simulate transmission chains</h1>
        <p>Last updated on 2025-09-25 |

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/superspreading-simulate.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can we simulate transmission chains based on infection
characteristics?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Estimate the potential for large outbreaks following the
introduction of a new case using a branching process with
<a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites</h3>
<div class="callout-content">
<p>Learners should familiarise themselves with the following concept
dependencies before working through this tutorial:</p>
<p><strong>Statistics</strong>: Common probability distributions,
including Poisson and negative binomial.</p>
<p><strong>Epidemic theory</strong>: The reproduction number, <span class="math inline">\(R\)</span>.</p>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h2>
<hr class="half-width"><!-- what we know --><p>Individual variation in transmission can affect both the potential
for an epidemic to establish in a population and the ease of control (<a href="https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371" class="external-link">Cori
et al., 2017</a>).</p>
<ul><li><p>Greater variation reduces the overall probably of a single new
case causing a large local outbreak, because most cases infect few
others and individuals that generate a large number of secondary cases
are relatively rare.</p></li>
<li><p>However, if a ‘superspreading event’ does occur and the outbreak
gets established, this variation can make an outbreak harder to control
using <em>mass interventions</em> (i.e. blanket interventions that
implicitly assume everyone contributes equally to transmission), because
some cases contribute disproportionality: a single uncontrolled case may
generate a large number of secondary cases.</p></li>
<li><p>Conversely, variation in transmission may provide opportunities
for <em>targeted interventions</em> if the individuals who contribute
more to transmission (due to biological or behavioural factors), or the
settings in which ‘superspreading events’ occur, share
socio-demographic, environmental or geographical characteristics that
can be defined.</p></li>
</ul><!-- what we dont know --><p>How can we quantify the potential of a new infection to cause a large
outbreak based on its reproduction number <span class="math inline">\(R\)</span> and the dispersion <span class="math inline">\(k\)</span> of its offspring distribution?</p>
<figure style="text-align: center"><img src="fig/superspreading-simulate-rendered-unnamed-chunk-1-1.png" alt="Observed number of cumulative cases from the Middle East respiratory syndrome (MERS) outbreak in South Korea, 2015, alongside with simulated transmission chains assuming an offspring distribution with $R=0.6$ and $k=0.02$." class="figure mx-auto d-block"><figcaption>
Observed number of cumulative cases from the Middle East respiratory
syndrome (MERS) outbreak in South Korea, 2015, alongside with simulated
transmission chains assuming an offspring distribution with <span class="math inline">\(R=0.6\)</span> and <span class="math inline">\(k=0.02\)</span>.
</figcaption></figure><!-- what we are going to do --><p>In this episode, we will use the <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> package to
simulate transmission chains and estimate the potential for large
outbreaks following the introduction of a new case. We are going to use
it with functions from <a href="https://github.com/epiverse-trace/epiparameter/" class="external-link">epiparameter</a>, <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>
and <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a>, so also loading the <a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a>
package:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epichains</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span></code></pre>
</div>
<div id="the-double-colon" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="the-double-colon" class="callout-inner">
<h3 class="callout-title">The double-colon</h3>
<div class="callout-content">
<p>The double-colon <code>::</code> in R let you call a specific
function from a package without loading the entire package into the
current environment.</p>
<p>For example, <code>dplyr::filter(data, condition)</code> uses
<code>filter()</code> from the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> package.</p>
<p>This help us remember package functions and avoid namespace
conflicts.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="simulation-of-uncontrolled-outbreaks">Simulation of uncontrolled outbreaks<a class="anchor" aria-label="anchor" href="#simulation-of-uncontrolled-outbreaks"></a></h2>
<hr class="half-width"><p>Infectious disease epidemics spread through populations when a chain
of infected individuals transmit the infection to others. <a href="https://epiverse-trace.github.io/epichains/articles/theoretical_background.html" class="external-link">Branching
processes</a> can be used to model this transmission. A branching
process is a stochastic process (i.e. a random process that can be
described by a known probability distribution), where each infectious
individual gives rise to a random number of individuals in the next
generation of infection, starting with the index case in generation 1.
The distribution of the number of secondary cases each individual
generates is called the offspring distribution (<a href="https://epiverse-trace.github.io/epichains/articles/epichains.html" class="external-link">Azam
&amp; Funk, 2024</a>).</p>
<p><a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> provides methods to analyse and simulate the
<em>size</em> and <em>length</em> of branching processes with an given
offspring distribution. <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> implements a rapid and
simple model to simulate transmission chains to assess epidemic risk,
project cases into the future, and evaluate interventions that change
<span class="math inline">\(R\)</span>.</p>
<div id="chain-size-and-length" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="chain-size-and-length" class="callout-inner">
<h3 class="callout-title">chain size and length</h3>
<div class="callout-content">
<ul><li><p>The <strong>size</strong> of the transmission chain is defined as
the total number of individuals infected across all generations of
infection, and</p></li>
<li><p>the <strong>length</strong> of the transmission chain is the
number of generations from the first case to the last case in the
outbreak before the chain ended.</p></li>
</ul><p>The <em>size</em> calculation includes the first case, and the
<em>length</em> calculation contains the first generation when the first
case starts the chain (See figure below).</p>
<figure><img src="https://raw.githubusercontent.com/epiverse-trace/epichains/main/vignettes/img/transmission_chain_example.png" alt="An example of a transmission chain starting with a single case C1. Cases are represented by blue circles and arrows indicating who infected whom. The chain grows through generations Gen 1, Gen 2, and Gen 3, producing cases C2, C3, C4, C5, and C6. The chain ends at generation Gen 3 with cases C4, C5, and C6. The size of C1’s chain is 6, including C1 (that is, the sum of all blue circles), and the length is 3, which includes Gen 1 (maximum number of generations reached by C1’s chain) (Azam &amp; Funk, 2024)." class="figure mx-auto d-block"><div class="figcaption">
<strong>An example of a transmission chain
starting with a single case C1.</strong> Cases are represented by blue
circles and arrows indicating who infected whom. The chain grows through
generations Gen 1, Gen 2, and Gen 3, producing cases C2, C3, C4, C5, and
C6. The chain ends at generation Gen 3 with cases C4, C5, and C6. The
size of C1’s chain is 6, including C1 (that is, the sum of all blue
circles), and the length is 3, which includes Gen 1 (maximum number of
generations reached by C1’s chain) (<a href="https://epiverse-trace.github.io/epichains/articles/epichains.html" class="external-link">Azam
&amp; Funk, 2024</a>).</div>
</figure></div>
</div>
</div>
<p>To use <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>, we need to know (or assume) two key
epidemiological values: the offspring distribution and the generation
time.</p>
</section><section><h2 class="section-heading" id="get-the-offspring-distribution">Get the offspring distribution<a class="anchor" aria-label="anchor" href="#get-the-offspring-distribution"></a></h2>
<hr class="half-width"><p>Here we assume the MERS offspring distribution follows a negative
binomial distribution, with mean (reproduction number <span class="math inline">\(R\)</span>) and dispersion <span class="math inline">\(k\)</span> values estimated from the linelist and
contact data of <code>mers_korea_2015</code> in the
<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> R package in the previous episode.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mers_offspring</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">0.60</span>, dispersion <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span></span></code></pre>
</div>
<div id="offspring-distribution-for-epichains" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="offspring-distribution-for-epichains" class="callout-inner">
<h3 class="callout-title">offspring distribution for epichains</h3>
<div class="callout-content">
<p>We input an offspring distribution to <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> by
referring to the R function that generates random values from the
distribution we want. For a negative binomial distribution, we use
<code>rnbinom</code> with its corresponding <code>mu</code> and
<code>size</code> arguments:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>  offspring_dist <span class="ot">=</span> rnbinom,</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  mu <span class="ot">=</span> mers_offspring[<span class="st">"mean"</span>],</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  size <span class="ot">=</span> mers_offspring[<span class="st">"dispersion"</span>],</span></code></pre>
</div>
<p>Internally, <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> will draw one random value,
given the parameters, to simulate the number of new infections from an
infected individual (onward transmission).</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># generate one random number given the distribution family and its parameters</span></span>
<span><span class="co"># (run this line many times to get different values)</span></span>
<span><span class="fu">rnbinom</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>, size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<p>The reference manual in <code>?rnbinom</code> tells us our required
specific arguments.</p>
</div>
</div>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Poisson and other distributions </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p><a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> can accept any R function that generates
random numbers, so the specified arguments will change depending on the
R function used. For more details on the range of possible options, see
the function reference manual.</p>
<p>For example, let’s say we want to use a Poisson distribution for the
offspring distribution. First, read the argument required in the
<code>?rpois</code> reference manual. Second, specify the
<code>lambda</code> argument parameter, also known as rate or mean in
the literature. In <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>, this can look like
this:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>  offspring_dist <span class="ot">=</span> rpois,</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  lambda <span class="ot">=</span> mers_offspring[<span class="st">"mean"</span>],</span></code></pre>
</div>
<p>In this example, we can specify
<code>lambda = mers_offspring["mean"]</code> because the mean number of
secondary cases generated (i.e. <span class="math inline">\(R\)</span>)
should be the same regardless of the distribution we assume. What
changes is the variance of the distribution, and hence the level of
individual-level variation in transmission. When the dispersion
parameter <span class="math inline">\(k\)</span> approaches infinity
(<span class="math inline">\(k \rightarrow \infty\)</span>) in a
negative binomial distribution, the variance equals the mean. This makes
the conventional Poisson distribution a special case of the negative
binomial distribution.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="get-generation-time">Get generation time<a class="anchor" aria-label="anchor" href="#get-generation-time"></a></h2>
<hr class="half-width"><p>The <a href="reference.html#serialinterval">serial interval</a>
distribution is often used to approximate the generation time
distribution. This approximation is commonly used because it is easier
to observe and measure the onset of symptoms in each case than the
precise time of infection.</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> generation time vs serial interval </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<figure><img src="fig/serial-interval-observed.jpeg" alt="A schematic of the relationship of different time periods of transmission between an infector and an infectee in a transmission pair. Exposure window is defined as the time interval having viral exposure, and transmission window is defined as the time interval for onward transmission with respect to the infection time (Chung Lau et al., 2021)." class="figure mx-auto d-block"><div class="figcaption">A schematic of the relationship of different
time periods of transmission between an infector and an infectee in a
transmission pair. Exposure window is defined as the time interval
having viral exposure, and transmission window is defined as the time
interval for onward transmission with respect to the infection time (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>).</div>
</figure><p>However, using the <em>serial interval</em> as an approximation of
the <em>generation time</em> is primarily valid for diseases in which
infectiousness starts after symptom onset (<a href="https://academic.oup.com/jid/article/224/10/1664/6356465" class="external-link">Chung
Lau et al., 2021</a>). In cases where infectiousness starts before
symptom onset, the serial intervals can have negative values, which is
the case for diseases with pre-symptomatic transmission (<a href="https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext#gr2" class="external-link">Nishiura
et al., 2020</a>).</p>
</div>
</div>
</div>
</div>
<p>Let’s use the <a href="https://github.com/epiverse-trace/epiparameter/" class="external-link">epiparameter</a> package to access and use
the available serial interval for MERS disease.
<!-- For `{epichains}` we need a **discretised** input distribution, se we use `epiparameter::discretise()`: --></p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">serial_interval</span> <span class="op">&lt;-</span> <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epiparameter_db</span><span class="op">(</span></span>
<span>  disease <span class="op">=</span> <span class="st">"mers"</span>,</span>
<span>  epi_name <span class="op">=</span> <span class="st">"serial"</span>,</span>
<span>  single_epiparameter <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">serial_interval</span>, day_range <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">25</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-4-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The serial interval for MERS has a mean of 12.6 days and a standard
deviation of 2.8 days.</p>
<div id="generation-time-for-epichains" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="generation-time-for-epichains" class="callout-inner">
<h3 class="callout-title">generation time for epichains</h3>
<div class="callout-content">
<p>In each simulation step, <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> will draw
generation time values for each new infection generated from the
offspring distribution. With <code>&lt;epiparameter&gt;</code> class
objects we can use the distribution function
<code>epiparameter::generate()</code> for this input.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In step one, the number of new infections is 2, then:</span></span>
<span><span class="co"># generate 2 random values given the serial interval distribution</span></span>
<span><span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 14.60507 15.06471</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># In step two, the number of new infections is 6, then:</span></span>
<span><span class="co"># generate 6 random values given the serial interval distribution</span></span>
<span><span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 12.522027 16.109812 14.195049  6.875113 15.432142 12.349850</code></pre>
</div>
<p>Given that the input value in <code>times</code> will vary each step,
we need to embed <code>generate()</code> within a function.
<a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> will draw as many random values from the
generation time as number of new infections in that step. This will look
like this:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></code></pre>
</div>
<p>This interface is similar to the one <a href="https://github.com/epiverse-trace/cfr" class="external-link">cfr</a> uses to link
with <a href="https://github.com/epiverse-trace/epiparameter/" class="external-link">epiparameter</a>. Read the <a href="https://epiverse-trace.github.io/cfr/articles/delay_distributions.html" class="external-link">work
with delay distributions</a> vignette for further context.</p>
</div>
</div>
</div>

</section><section><h2 class="section-heading" id="simulate-a-single-chain">Simulate a single chain<a class="anchor" aria-label="anchor" href="#simulate-a-single-chain"></a></h2>
<hr class="half-width"><p>Now we are prepared to use the <code>simulate_chains()</code>
function from <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> to create <strong>one</strong>
transmission chain:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>  n_chains <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>  offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>  mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>  size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p><code>simulate_chains()</code> requires three sets of arguments as a
minimum:</p>
<ul><li>
<strong>simulation controls</strong> (<code>n_chains</code> and
<code>statistic</code>),</li>
<li>
<strong>offspring distribution</strong> (<code>offspring_dist</code>
and required distribution parameters), and</li>
<li>generation time (<code>generation_time</code>).</li>
</ul><p>In the lines above, we described how to specify the offspring
distribution and generation time. The <strong>simulation
controls</strong> include at least two arguments:</p>
<ul><li>
<code>n_chains</code>, which defines the number of transmission
chains to simulate for and</li>
<li>
<code>statistic</code>, which defines a chain statistic to track
(either <code>"size"</code> or <code>"length"</code>) as the stopping
criteria for each chain being simulated.</li>
</ul><div id="stopping-criteria" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="stopping-criteria" class="callout-inner">
<h3 class="callout-title">Stopping criteria</h3>
<div class="callout-content">
<p>This is an customisable feature of <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>. By
default, branching process simulations end when they have gone extinct.
For long-lasting transmission chains, in <code>simulate_chains()</code>
you can add the <code>stat_threshold</code> argument.</p>
<p>For example, if we set an stopping criteria for
<code>statistic = "size"</code> of <code>stat_threshold = 500</code>, no
more offspring will be produced after a chain of size 500.</p>
</div>
</div>
</div>
<p>The <code>simulate_chains()</code> output creates a
<code>&lt;epichains&gt;</code> class object, which we can then analyse
further in R.</p>
</section><section><h2 class="section-heading" id="simulate-multiple-chains">Simulate multiple chains<a class="anchor" aria-label="anchor" href="#simulate-multiple-chains"></a></h2>
<hr class="half-width"><p>We can use <code>simulate_chains()</code> to create multiple chains
and increase the probability of simulating uncontrolled outbreak
projections given an overdispersed offspring distribution.</p>
<p>We need to one additional element:</p>
<ul><li>
<code>set.seed(&lt;integer&gt;)</code>, which is a random number
generator function with a specified seed value, the
<code>&lt;integer&gt;</code> number, to ensure consistent results across
different runs of the code.</li>
</ul><p>With this configuration, each <strong>chain</strong> will represent
<strong>one initial case</strong>. These cases per chain are
independent, isolated, and without interactions. This means that each
chain will have their own pool of susceptibles, which you can configure
by using the <code>pop</code> or <code>percent_immune</code>
arguments.</p>
<p>Now, let’s simulate <strong>100</strong> transmission chains:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run all this chunk together to let set.seed() work!</span></span>
<span><span class="co"># Set seed for random number generator</span></span>
<span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span><span class="va">multiple_epichains</span> <span class="op">&lt;-</span> <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>  n_chains <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>  offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>  mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>  size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>You can inspect the total <strong>size</strong> of each simulated
chain, equivalent to the cumulative number of cases per chain, using the
<code>summary()</code> to the <code>&lt;epichains&gt;</code> class
object:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">summary</span><span class="op">(</span><span class="va">multiple_epichains</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`epichains_summary` object

  [1]   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
 [19]   7   1   1   1   1   1   1   1   1   1   1  14   1   2   1   1   2   1
 [37]   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
 [55]   1   1   1   1 512   1   1   1   1   1 104   1   1   1   1   1   1   1
 [73]   1   1   1   1   1   1   1   1   1   4   1   1   1   1   1   1   1   1
 [91]   1   1   1   1   1   1   1   1   1   1

 Simulated sizes:

Max: 512
Min: 1</code></pre>
</div>
<p>We can visually count how many chains reach to more than 100 infected
cases, with the maximum and minimun counts too.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Use the last run of <code>epichains::simulate_chains()</code> for
simulating multiple chains. Change the <code>statistic</code> from
<code>"size"</code> to <code>"length"</code>. Run the
<code>summary()</code> function.</p>
<ul><li>What chain feature this output count for?</li>
</ul></div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>If you need help, return to the “Chain size and length” callout box
from the beginning.</p>
</div>
</div>
</div>
</div>
<div id="read-the-epichains-output" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="read-the-epichains-output" class="callout-inner">
<h3 class="callout-title">Read the epichains output</h3>
<div class="callout-content">
<p>To explore the output format of the <code>&lt;epichains&gt;</code>
class object of name <code>multiple_epichains</code>, let’s look at the
simulated <code>chain</code> number 30.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> The epichains object </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Let’s use <code>dplyr::filter()</code> for this:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chain_to_observe</span> <span class="op">&lt;-</span> <span class="fl">30</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### get epichain summary ----------------------------------------------------</span></span>
<span></span>
<span><span class="va">multiple_epichains</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="va">chain</span> <span class="op">==</span> <span class="va">chain_to_observe</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`&lt;epichains&gt;` object

&lt; epichains head (from first known infector) &gt;

  chain infector infectee generation      time
2    30        1        2          2 14.100967
3    30        1        3          2 10.640301
4    30        1        4          2 15.608764
5    30        1        5          2 13.515424
6    30        1        6          2  9.967474
7    30        1        7          2  9.376222


Number of chains: 100
Number of infectors (known): 3
Number of generations: 3
Use `as.data.frame(&lt;object_name&gt;)` to view the full output in the console.</code></pre>
</div>
<p>This output contains two parts:</p>
<ul><li>A <code>head()</code> print of the infector-infectee pairs
<strong>starting from the first known infector</strong>.</li>
<li>A summary footer, the piece of text that appears at the bottom:</li>
</ul><div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Number of infectors (known): 3
Number of generations: 3</code></pre>
</div>
<p>The simulated <code>chain</code> number 30 has three known infectors
and three generations. These numbers are more visible when printing the
<code>&lt;epichains&gt;</code> objects as a data frame (or
<code>&lt;tibble&gt;</code>).</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> The epichains data frame </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### infector-infectee data frame --------------------------------------------</span></span>
<span></span>
<span><span class="va">multiple_epichains</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="va">chain</span> <span class="op">==</span> <span class="va">chain_to_observe</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 14 × 5
   chain infector infectee generation  time
   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;      &lt;int&gt; &lt;dbl&gt;
 1    30       NA        1          1  0
 2    30        1        2          2 14.1
 3    30        1        3          2 10.6
 4    30        1        4          2 15.6
 5    30        1        5          2 13.5
 6    30        1        6          2  9.97
 7    30        1        7          2  9.38
 8    30        1        8          2 11.5
 9    30        4        9          3 31.0
10    30        4       10          3 25.3
11    30        4       11          3 28.5
12    30        4       12          3 29.6
13    30        4       13          3 25.9
14    30        4       14          3 24.6 </code></pre>
</div>
<p>Chain 30 tells us a <strong>story</strong>:</p>
<p>“In the first transmission generation at <code>time = 0</code>, one
subject (<code>ID = NA</code>) infected the subject with
<code>ID = 1</code>. Subject <code>ID = 1</code> is the first known
infector.</p>
<p>“Then, in the second transmission generation, subject
<code>ID = 1</code> infected seven subjects, from <code>ID = 2</code> to
<code>ID = 8</code>. These infections ocurred in <code>time</code>
between day 9 and day 15, after the first known infection.</p>
<p>“Later, in the third transmission generation, subject
<code>ID = 4</code> infected six new subjects, from <code>ID = 9</code>
to <code>ID = 14</code>. These infections ocurred in <code>time</code>
between day 24 and day 31, after the first known infection.”</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> An infectee data frame </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p>The output data frame collects <strong>infectees</strong> as the
observation unit:</p>
<ul><li>Each infectee has a <code>infectee</code> “ID”.</li>
<li>Each <em>infectee</em> that behaved as an <em>infector</em> is
registered in the <code>infector</code> column using
<code>infectee</code> “id”.</li>
<li>Each infectee got infected in a specific <code>generation</code> and
(continuous) <code>time</code>.</li>
<li>The simulation number is registered under the <code>chain</code>
column.</li>
</ul><p><strong>Note:</strong> The <code>Number of infectors (known)</code>
includes the subject <code>ID = NA</code> under the
<code>infector</code> column. This refers to the infector specified as
index case (in the <code>n_chains</code> argument), which started the
transmission chain to the infectee of <code>ID = 1</code>, at
<code>generation = 1</code>, and <code>time = 0</code>.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="iterate-simulations">Iterate simulations<a class="anchor" aria-label="anchor" href="#iterate-simulations"></a></h2>
<hr class="half-width"><p>As before, we can configure the simulation of multiple chains by
simply increasing the number of chains (e.g., from
<code>n_chains = 1</code> to <code>n_chains = 100</code>). However, if
we need to assume that each initial case starts (being infectious) at a
different time, this can only be configured in one simulation function.
Thus, we need to <strong>iterate</strong> multiple times over one
specific chain simulation configuration to increase the probability of
simulating uncontrolled outbreak projections. The following table
compares the alternatives:</p>
<table class="table"><colgroup><col width="25%"><col width="25%"><col width="25%"><col width="25%"></colgroup><thead><tr class="header"><th>Simulation runs</th>
<th>Initial cases</th>
<th>Start time (<code>t0</code>)</th>
<th>Use</th>
</tr></thead><tbody><tr class="odd"><td>One</td>
<td>1</td>
<td>Same</td>
<td>
<code>epichains::simulate_chains()</code> with
<code>n_chains = 1</code>
</td>
</tr><tr class="even"><td>Multiple (100, e.g.)</td>
<td>1</td>
<td>Same</td>
<td>
<code>epichains::simulate_chains()</code> with
<code>n_chains = 100</code>
</td>
</tr><tr class="odd"><td>Multiple (100, e.g.)</td>
<td>More than one</td>
<td>Different</td>
<td>Iterate 100 times using <code>purrr::map()</code> over
<code>epichains::simulate()</code>
</td>
</tr></tbody></table><p>The key difference of the third configuration is the <code>t0</code>
argument from <code>epichains::simulate_chains()</code>. The argument
<code>t0</code> defines the start time of each initial case per
chain.</p>
<div id="callout4" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>One example of using iteration is available in the
<a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> vignette on <a href="https://epiverse-trace.github.io/epichains/articles/projecting_incidence.html" class="external-link">Projecting
infectious disease incidence: a COVID-19 example</a>. The aim is to
simulate the importation of 13 cases during different moments in
time.</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epichains</span><span class="fu">::</span><span class="va">covid19_sa</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>start_time <span class="op">=</span> <span class="va">date</span> <span class="op">-</span> <span class="fu">min</span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 5 × 3
  date       cases start_time
  &lt;date&gt;     &lt;int&gt; &lt;drtn&gt;
1 2020-03-05     1 0 days
2 2020-03-07     1 2 days
3 2020-03-08     1 3 days
4 2020-03-09     4 4 days
5 2020-03-11     6 6 days    </code></pre>
</div>
<p>Instead of having 100 chains starting on the same Day 0
(<code>t0 = 0</code>, as default), each simulation will create chains
that start at a different moment in time. It will consider day
<code>2020-03-05</code> as Day <code>0</code>. The first chain starts on
day 0, one in day 2, one in day 3, four in day 4, and six in day 6. The
argument <code>t0</code> will have this structure:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t0</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fu">rep</span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu">rep</span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t0</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code> [1] 0 2 3 4 4 4 4 6 6 6 6 6 6</code></pre>
</div>
<p>To increase the probability of simulating uncontrolled outbreak
projections, this same scenario need to be iterated 100 times. This will
help us to provide a projection with uncertainty.</p>
</div>
</div>
</div>
<p>In this section we’ll showcase how to build up the
<strong>iteration</strong> over <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> step by step.
We’ll conviniently replicate the same simulation as before: 100
transmission chains with 1 initial case each starting at day 0
(<code>t0 = 0</code>). But, instead of using
<code>n_chains = 100</code>, we’ll iterate 100 times over the simulation
of 1 transmission chain with 1 initial case each starting at day 0
(<code>n_chains = 1</code>).</p>
<p>We need to specify two additional elements:</p>
<ul><li>
<code>number_simulations</code>, which defines the number of
simulations to run.</li>
<li>
<code>initial_cases</code> defines the number of initial cases to
input to the <code>n_chains</code> argument explained in the lines
above.</li>
</ul><div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of simulation runs</span></span>
<span><span class="va">number_simulations</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="co"># Number of initial cases</span></span>
<span><span class="va">initial_cases</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre>
</div>
<p><code>number_simulations</code> and <code>initial_cases</code> are
conveniently stored in objects to facilitate downstream reuse in the
workflow.</p>
<div id="iteration-using-purrr" class="callout checklist">
<div class="callout-square">
<i class="callout-icon" data-feather="check-square"></i>
</div>
<div id="iteration-using-purrr" class="callout-inner">
<h3 class="callout-title">Iteration using purrr</h3>
<div class="callout-content">
<p><a href="https://r4ds.hadley.nz/iteration.html" class="external-link">Iteration</a> aims to
perform the same action on different objects repeatedly.</p>
<p>Learn how to use the core <a href="https://purrr.tidyverse.org/" class="external-link">purrr</a> functions like
<code>map()</code> from the YouTube tutorial on <a href="https://www.youtube.com/watch?v=nd-Y8b22YaQ" class="external-link">How to purrr</a> by
Equitable Equations.</p>
<p>Or, if you previously used the <code>*apply</code> family of
functions, visit the package vignette on <a href="https://purrr.tidyverse.org/articles/base.html" class="external-link">purrr base R</a>,
which shares key differences, direct translations, and examples.</p>
</div>
</div>
</div>
<p>To get multiple chains, we must apply the
<code>simulate_chains()</code> function to each chain defined by a
sequence of numbers from 1 to 100.</p>
<div id="purrr-and-epichains" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="purrr-and-epichains" class="callout-inner">
<h3 class="callout-title">purrr and epichains</h3>
<div class="callout-content">
<p>First, let’s sketch how we use <code>purrr::map()</code> with
<code>epichains::simulate_chains()</code>. The <code>map()</code>
function requires two arguments:</p>
<ul><li>
<code>.x</code>, with a vector of numbers, and</li>
<li>
<code>.f</code>, a function to iterate to each vector value.</li>
</ul><p>The code chunk below</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># steps:</span></span>
<span><span class="co"># - purrr::map() will run 100 times function(sim).</span></span>
<span><span class="co"># - seq_len() creates a vector with sequence of numbers (simulation IDs from 1 to 100) and</span></span>
<span><span class="co"># - function(sim) iterates {epichains} to each simulation ID number, then</span></span>
<span><span class="co"># - dplyr::mutate() adds a column to the &lt;epichains&gt; output with the simulation ID number.</span></span>
<span><span class="co"># - purrr::list_rbind() combines all the list class outputs (for each simulation ID) into a single data frame.</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="fu">seq_len</span><span class="op">(</span><span class="va">number_simulations</span><span class="op">)</span>,</span>
<span>  .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># &lt;-- {epichains}</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">list_rbind</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># pseudo code: do not run.</span></span></code></pre>
</div>
<p>The <code>sim</code> element is placed to register the iteration
number (<strong>simulation ID</strong>) as a new column in the
<code>&lt;epichains&gt;</code> output. The
<code>purrr::list_rbind()</code> function aims to combine all the list
outputs from <code>map()</code>.</p>
<p><strong>Why a dot (<code>.</code>) as a prefix before x and f
arguments?</strong> In the <a href="https://design.tidyverse.org/dots-prefix.html" class="external-link">tidy design
principles</a> book we have a chapter on the dot prefix!</p>
</div>
</div>
</div>
<p>Now, we are prepared to use <code>purrr::map()</code> to repeatedly
simulate from <code>simulate_chains()</code> and store in a vector from
1 to 100:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span><span class="va">simulated_chains_map</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">map</span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="fu">seq_len</span><span class="op">(</span><span class="va">number_simulations</span><span class="op">)</span>,</span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>        n_chains <span class="op">=</span> <span class="va">initial_cases</span>,</span>
<span>        statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>        offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>        mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>        size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>        generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>simulation_id <span class="op">=</span> <span class="va">sim</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu">list_rbind</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>One limitation of the iteration output is that, to summarize the
output, we can not use the <code>summary(&lt;epichains&gt;)</code>.</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulated_chains_map</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">simulation_id</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">pull</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  [1]   1   1   1   1   1   1   1   1   1   1   1   1   1   1   9   1   1   1
 [19]   1   1   1   1 113   1   1   1   1   1   1   1   1   1  19   1   1   1
 [37]   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
 [55]   1   1   1   1   1   1   1   1   1   1   1   1   1   1  22   1   1   1
 [73]   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
 [91]   1   1   1   1   1   1   1   1   1   1</code></pre>
</div>
</section><section><h2 class="section-heading" id="visualize-multiple-chains">Visualize multiple chains<a class="anchor" aria-label="anchor" href="#visualize-multiple-chains"></a></h2>
<hr class="half-width"><p>To increase the probability of simulating uncontrolled outbreak
projections given an overdispersed offspring distribution, let’s
simulate <strong>1000 transmission chains</strong> with 1 initial case
each starting at day 0.</p>
<p>We will create a multiple simulation <strong>without</strong>
iteration for this section:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set.seed</span><span class="op">(</span><span class="fl">33</span><span class="op">)</span></span>
<span><span class="va">multiple_epichains</span> <span class="op">&lt;-</span> <span class="fu">epichains</span><span class="fu">::</span><span class="fu">simulate_chains</span><span class="op">(</span></span>
<span>  n_chains <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>  offspring_dist <span class="op">=</span> <span class="va">rnbinom</span>,</span>
<span>  mu <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"mean"</span><span class="op">]</span>,</span>
<span>  size <span class="op">=</span> <span class="va">mers_offspring</span><span class="op">[</span><span class="st">"dispersion"</span><span class="op">]</span>,</span>
<span>  generation_time <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">generate</span><span class="op">(</span>x <span class="op">=</span> <span class="va">serial_interval</span>, times <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>To visualize the simulated chains, we need some pre-processing:</p>
<ol style="list-style-type: decimal"><li>Let’s use <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> to get round time numbers to resemble
surveillance days.</li>
<li>Count the daily cases in each simulation (by
<code>chain</code>).</li>
<li>Calculate the cumulative number of cases within a simulation.</li>
</ol><div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># daily aggregate of cases</span></span>
<span><span class="va">aggregate_chains</span> <span class="op">&lt;-</span> <span class="va">multiple_epichains</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># use data.frame output from &lt;epichains&gt; object</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># get the round number (day) of infection times</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>day <span class="op">=</span> <span class="fu">ceiling</span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># count the daily number of cases in each chain</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">chain</span>, <span class="va">day</span>, name <span class="op">=</span> <span class="st">"cases"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># calculate the cumulative number of cases for each chain</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>cases_cumsum <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">cases</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Before the plot, let’s create a summary table with the total time
duration and size of each chain. We can use the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>
“combo” of <code>group_by()</code>, <code>summarise()</code> and
<code>ungroup()</code>:</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarise the chain duration and size</span></span>
<span><span class="va">summary_chains</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">aggregate_chains</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">group_by</span><span class="op">(</span><span class="va">chain</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">summarise</span><span class="op">(</span></span>
<span>    <span class="co"># duration</span></span>
<span>    day_max <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">day</span><span class="op">)</span>,</span>
<span>    <span class="co"># size</span></span>
<span>    cases_total <span class="op">=</span> <span class="fu">max</span><span class="op">(</span><span class="va">cases_cumsum</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">summary_chains</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,000 × 3
   chain day_max cases_total
   &lt;int&gt;   &lt;dbl&gt;       &lt;int&gt;
 1     1       0           1
 2     2       0           1
 3     3       0           1
 4     4       0           1
 5     5       0           1
 6     6       0           1
 7     7       0           1
 8     8       0           1
 9     9       0           1
10    10       0           1
# ℹ 990 more rows</code></pre>
</div>
<p>Now, we are prepared for using the <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>
package:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize transmission chains by cumulative cases</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># create grouped chain trajectories</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">aggregate_chains</span>,</span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">day</span>,</span>
<span>      y <span class="op">=</span> <span class="va">cases_cumsum</span>,</span>
<span>      group <span class="op">=</span> <span class="va">chain</span></span>
<span>    <span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># define a 100-case threshold</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Day"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Cumulative cases"</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-22-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Although most introductions of 1 index case do not generate secondary
cases (N = 934) or most outbreaks rapidly become extinct (median
duration of 17 and median size of 5.5), only 1 epidemic trajectories
among 100 simulations (1%) can reach to more than 100 infected cases.
This finding is particularly remarkable because the reproduction number
<span class="math inline">\(R\)</span> is less than 1 (offspring
distribution mean of 0.6), but, given an offspring distribution
dispersion parameter of 0.02, it shows the potential for explosive
outbreaks of MERS disease.</p>
<p>We can count how many chains reached the 100-case threshold using
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> functions. This output should give us equivalent
results to <code>summary(multiple_epichains)</code>:</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of chains that reached the 100-case threshold</span></span>
<span><span class="va">summary_chains</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">cases_total</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">filter</span><span class="op">(</span><span class="va">cases_total</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 3
  chain day_max cases_total
  &lt;int&gt;   &lt;dbl&gt;       &lt;int&gt;
1    65      34         103</code></pre>
</div>
<div id="accordionSpoiler3" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler3" aria-expanded="false" aria-controls="collapseSpoiler3">
  <h3 class="accordion-header" id="headingSpoiler3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Observed cases vs simulated chains </h3>
</button>
<div id="collapseSpoiler3" class="accordion-collapse collapse" aria-labelledby="headingSpoiler3" data-bs-parent="#accordionSpoiler3">
<div class="accordion-body">
<p>Let’s overlap the cumulative number of observed cases using the
linelist object from the <code>mers_korea_2015</code> dataset of the
<a href="https://github.com/reconhub/outbreaks" class="external-link">outbreaks</a> R package. To prepare the dataset so we can
plot daily total cases over time, we use <a href="https://www.reconverse.org/incidence2/" class="external-link">incidence2</a> to
convert the linelist to an <code>&lt;incidence2&gt;</code> object,
complete the missing dates of the time series with
<code>complete_dates()</code></p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">outbreaks</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mers_cumcases</span> <span class="op">&lt;-</span> <span class="va">mers_korea_2015</span><span class="op">$</span><span class="va">linelist</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># incidence2 workflow</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">incidence</span><span class="op">(</span>date_index <span class="op">=</span> <span class="st">"dt_onset"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">incidence2</span><span class="fu">::</span><span class="fu">complete_dates</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># wrangling using {dplyr}</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>count_cumsum <span class="op">=</span> <span class="fu">cumsum</span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu">rownames_to_column</span><span class="op">(</span>var <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">mutate</span><span class="op">(</span>day <span class="op">=</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="va">day</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>Use <code>plot()</code> to make an incidence plot:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the incidence2 object</span></span>
<span><span class="fu">plot</span><span class="op">(</span><span class="va">mers_cumcases</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-26-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure></div>
</div>
</div>
</div>
<p>When plotting the observed number of cumulative cases from the Middle
East respiratory syndrome (MERS) outbreak in South Korea in 2015
alongside the previously simulated chains, we see that the observed
cases followed a trajectory that is consistent with the simulated
explosive outbreak dynamics (which makes sense, given the simulation
uses parameters based on this specific outbreak).</p>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-27-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>When we increase the dispersion parameter from <span class="math inline">\(k = 0.01\)</span> to <span class="math inline">\(k
= \infty\)</span> - and hence reduce individual-level variation in
transmission - and assume a fixed reproduction number <span class="math inline">\(R = 1.5\)</span>, the proportion of simulated
outbreaks that reached the 100-case threshold increases. This is because
the simulated outbreaks now have more of a consistent, clockwise
dynamic, rather than the high level of variability seen previously.</p>
<figure><img src="fig/see-nature04153_Fig2-c.jpg" alt="Growth of simulated outbreaks with R = 1.5 and one initial case, conditional on non-extinction. Boxes show the median and interquartile range (IQR) of the first disease generation with 100 cases; whiskers show the most extreme values within 1.5 × IQR of the boxes, and crosses show outliers. Percentages show the proportion of 10,000 simulated outbreaks that reached the 100-case threshold (Lloyd-Smith et al., 2005)." class="figure mx-auto d-block"><div class="figcaption">
<strong>Growth of simulated outbreaks with R =
1.5 and one initial case, conditional on non-extinction.</strong> Boxes
show the median and interquartile range (IQR) of the first disease
generation with 100 cases; whiskers show the most extreme values within
1.5 × IQR of the boxes, and crosses show outliers. Percentages show the
proportion of 10,000 simulated outbreaks that reached the 100-case
threshold (<a href="https://www.nature.com/articles/nature04153" class="external-link">Lloyd-Smith et al.,
2005</a>).</div>
</figure><div id="early-spread-projections" class="callout testimonial">
<div class="callout-square">
<i class="callout-icon" data-feather="heart"></i>
</div>
<div id="early-spread-projections" class="callout-inner">
<h3 class="callout-title">Early spread projections</h3>
<div class="callout-content">
<p>In the epidemic’s initial phase, you can use <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>
to apply a branching process model to project the number of future
cases. Even though the model accounts for randomness in transmission and
variation in the number of secondary cases, there may be additional
local features we have not considered. Analysis of early forecasts made
for COVID in different countries using this model structure found that
predictions were often overconfident (<a href="https://www.eurosurveillance.org/content/10.2807/1560-7917.ES.2020.25.18.2000543#validationofthemodel-1" class="external-link">Pearson
et al., 2020</a>). This is likely because the real-time model did not
include all the changes in the offspring distribution that were
happening at the local level as a result of behaviour change and control
measures. You can read more about the importance of local context in
COVID-19 models in <a href="https://www.nature.com/articles/s43588-020-00014-7" class="external-link">Eggo et
al. (2020)</a>.</p>
<p>We invite you to read the vignette on <a href="https://epiverse-trace.github.io/epichains/articles/projecting_incidence.html" class="external-link">Projecting
infectious disease incidence: a COVID-19 example</a>! for more on making
predictions using <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="challenges">Challenges<a class="anchor" aria-label="anchor" href="#challenges"></a></h2>
<hr class="half-width"><div id="monkeypox-large-outbreak-potential" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="monkeypox-large-outbreak-potential" class="callout-inner">
<h3 class="callout-title">Monkeypox large outbreak potential</h3>
<div class="callout-content">
<p>Evaluate the potential for a new Monkey pox (Mpox) case to generate
an explosive large outbreak.</p>
<ul><li>Simulate 1000 transmission chains with 1 initial case each starting
at day 0.</li>
<li>Use the appropriate package to access delay data from previous
outbreaks.</li>
<li>How many simulated trajectories reach more than 100 infected
cases?</li>
</ul></div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>With <a href="https://github.com/epiverse-trace/epiparameter/" class="external-link">epiparameter</a>, you can access and use offspring
and delay distributions from previous Ebola outbreaks.</p>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">epiparameter</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epiparameter_db</span><span class="op">(</span>epi_name <span class="op">=</span> <span class="st">"offspring"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">disease</span>, <span class="va">epi_name</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    6 × 3
  disease                       epi_name                   n
  &lt;chr&gt;                         &lt;chr&gt;                  &lt;int&gt;
1 Ebola Virus Disease           offspring distribution     1
2 Hantavirus Pulmonary Syndrome offspring distribution     1
3 Mpox                          offspring distribution     1
4 Pneumonic Plague              offspring distribution     1
5 SARS                          offspring distribution     2
6 Smallpox                      offspring distribution     4</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">epiparameter_db</span><span class="op">(</span>epi_name <span class="op">=</span> <span class="st">"serial interval"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">epiparameter</span><span class="fu">::</span><span class="fu">parameter_tbl</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">count</span><span class="op">(</span><span class="va">disease</span>, <span class="va">epi_name</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># Parameter table:
# A data frame:    6 × 3
  disease               epi_name            n
  &lt;chr&gt;                 &lt;chr&gt;           &lt;int&gt;
1 COVID-19              serial interval     4
2 Ebola Virus Disease   serial interval     4
3 Influenza             serial interval     1
4 MERS                  serial interval     2
5 Marburg Virus Disease serial interval     2
6 Mpox                  serial interval     5</code></pre>
</div>
<p>Also, given that you only need one chain per iteration starting the
same day, it may not be necessary to use iteration for this one.</p>
</div>
</div>
</div>
</div>

<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Epidemic Risk assessment accounting for superspreading </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" aria-labelledby="headingHint3" data-bs-parent="#accordionHint3">
<div class="accordion-body">
<p>With <a href="https://github.com/epiverse-trace/superspreading" class="external-link">superspreading</a>, you can get numerical solutions
to processes that <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> solve using branching
processes. We invite you to read the <a href="https://github.com/epiverse-trace/superspreading" class="external-link">superspreading</a>
vignette on <a href="https://epiverse-trace.github.io/superspreading/articles/epidemic_risk.html" class="external-link">Epidemic
risk</a> and respond to:</p>
<ul><li>What is the probability that a newly introduced pathogen will cause
a large outbreak?</li>
<li>What is the probability that an infection will, by chance, fail to
establish following initial introduction(s)?</li>
<li>What is the probability the outbreak will be contained?</li>
</ul><p>Check how these estimates vary non-linearly with respect to the mean
reproduction number <span class="math inline">\(R\)</span> and
dispersion <span class="math inline">\(k\)</span> of a given
disease.</p>
<!-- draft challenge -->
<!-- Calculate the probability a new Mpox case will lead to a large outbreak in the absence of control measures. Use the appropriate package to access delay data from previous outbreaks. -->
</div>
</div>
</div>
</div>
<div id="from-a-distribution-of-secondary-cases" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="from-a-distribution-of-secondary-cases" class="callout-inner">
<h3 class="callout-title">From a distribution of secondary cases</h3>
<div class="callout-content">
<p><a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(15)70135-0/fulltext" class="external-link">Christian
Althaus, 2015</a> reused data published by <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(14)71075-8/fulltext#gr2" class="external-link">Faye
et al., 2015 (Figure 2)</a> on the transmission tree on Ebola virus
disease in Conakry, Guinea, 2014.</p>
<p>Using the data under the <strong>hint</strong> tab:</p>
<ul><li>Estimate the offspring distribution from the distribution of
secondary cases.</li>
<li>Then estimate the large outbreak potential from this data,
simulating 100 runs with one initial case.</li>
<li>Print the summary of the <code>&lt;epichains&gt;</code> class
object. This should help us count how many chains reach a
<code>size</code> of more than 100 infected cases.</li>
</ul><p>For reproducible results use <code>set.seed(645)</code>.</p>
</div>
</div>
</div>
<div id="accordionHint4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint4" aria-expanded="false" aria-controls="collapseHint4">
  <h4 class="accordion-header" id="headingHint4"> Give me a hint </h4>
</button>
<div id="collapseHint4" class="accordion-collapse collapse" aria-labelledby="headingHint4" data-bs-parent="#accordionHint4">
<div class="accordion-body">
<p>Code with the transmission tree data written by <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(15)70135-0/fulltext" class="external-link">Christian
Althaus, 2015</a>:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of individuals in the trees</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">152</span></span>
<span><span class="co"># Number of secondary cases for all individuals</span></span>
<span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">14</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span>
<span>        <span class="fl">4</span>, <span class="fl">9</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">17</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>,</span>
<span>        <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">c0</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="va">c1</span>, <span class="fu">rep</span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span> <span class="op">-</span> <span class="fu">length</span><span class="op">(</span><span class="va">c1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">c0</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">enframe</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/superspreading-simulate-rendered-unnamed-chunk-32-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Optional challenge:</p>
<ul><li>Reproduce Figure (B) from <a href="https://www.thelancet.com/journals/laninf/article/PIIS1473-3099(15)70135-0/fulltext" class="external-link">Christian
Althaus, 2015</a> with the simulation output.</li>
</ul></div>
</div>
</div>
</div>

<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Use <a href="https://github.com/epiverse-trace/epichains" class="external-link">epichains</a> to simulate the large outbreak
potential of diseases with overdispersed offspring distributions.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="superspreading-estimate.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="superspreading-estimate.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Account for
        </a>
        <a class="chapter-link float-end" href="index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/epiverse-trace/tutorials-middle/edit/main/episodes/superspreading-simulate.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/epiverse-trace/tutorials-middle/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/epiverse-trace/tutorials-middle/" class="external-link">Source</a></p>
				<p><a href="https://github.com/epiverse-trace/tutorials-middle/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:andree.valle-campos@lshtm.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/epiverse-trace/sandpaper/tree/patch-renv-github-bug" class="external-link">sandpaper (0.16.13.9000)</a>, <a href="https://github.com/carpentries/pegboard/tree/7dc6acfdd6233c0d124a0ecf288325edc40dd96d" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/epiverse-trace/varnish/tree/epiversetheme" class="external-link">varnish (1.0.7.9000)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://epiverse-trace.github.io/tutorials-middle/superspreading-simulate.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "forecasts, epidemic models, interventions",
  "name": "Simulate transmission chains",
  "creativeWorkStatus": "active",
  "url": "https://epiverse-trace.github.io/tutorials-middle/superspreading-simulate.html",
  "identifier": "https://epiverse-trace.github.io/tutorials-middle/superspreading-simulate.html",
  "dateCreated": "2025-09-29",
  "dateModified": "2025-09-25",
  "datePublished": "2025-09-29"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

